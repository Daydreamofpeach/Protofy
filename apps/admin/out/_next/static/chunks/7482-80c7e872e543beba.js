(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7482],{67482:function(r,m,h){"use strict";let u;h.d(m,{Z:function(){return nZ}});var _,f,g={};h.r(g),h.d(g,{GPIOSwitch:function(){return eg},a4988:function(){return nm},adcSensor:function(){return eb},bh1750:function(){return eX},binarySensor:function(){return eo},capacitiveSoilMoistureSensor:function(){return eD},climateIR:function(){return ez},deepSleep:function(){return ea},device:function(){return el},dfPlayer:function(){return eN},ds18b20:function(){return ng},ethernet:function(){return ns},hm3301:function(){return eQ},hx711:function(){return eI},i2cBus:function(){return ne},i2cSensorMatrix:function(){return e6},isOutput:function(){return eM},ledcOutput:function(){return eS},mhz19:function(){return e7},microfirePhEcTemp:function(){return nr},modbusLoadCell:function(){return eK},mpr121:function(){return eW},mpu6050:function(){return e5},mqtt:function(){return en},neopixelsBus:function(){return em},nfcreader:function(){return eC},output:function(){return ep},pca9685:function(){return ni},pirSensor:function(){return eA},pulseCounter:function(){return ew},r503:function(){return np},relay:function(){return eg},scd4x:function(){return n_},sen0377:function(){return e1},sen55:function(){return e8},servo:function(){return eB},tempHumidity:function(){return eZ},uartBus:function(){return nl},ultrasonicDistanceSensor:function(){return eq},wifi:function(){return et},xiaomiMiFlora:function(){return ej}});var w=h(52322),S=h(41585),E=h(57909),A=h(32627),T=h(75370),I=h(30195),P=h(54283);let D=T.V_.object({name:I.z.string().hint("ESP32, AT-MEGA2560  ARMv7, Protofy, ...").static().id(),sdks:I.z.array(I.z.string()).hint("esphome, platformio, wled, javascript, ...").hidden(),config:I.z.record(I.z.string(),I.z.any()).optional().onCreate("getConfig").onUpdate("getConfig")}),R=P.$.createDerived("DeviceCoreModel",D);var C=h(6289),q=h(26887),L=h(48115),M=h(33991),F=h(21044),N=h(50897),O=h(79562),G=h(1888),z=h(6364);let U=T.V_.object({id:I.z.string().generate((0,z.Z)()).id(),name:I.z.string().hint("MicroPython, Platformio...").static(),config:I.z.record(I.z.string().optional(),I.z.any()).generate({})}),B=P.$.createDerived("DeviceSdkModel",U);var H=h(2784);let W={name:A.V,sdk:E.S},V="/adminapi/v1/devicecores",Z="/adminapi/v1/devicesdks?all=1";var $={component:r=>{var m;let{pageState:h,initialItems:u,itemData:_,pageSession:f,extraData:g}=r,[E,A]=(0,H.useState)(null!==(m=null==g?void 0:g.sdks)&&void 0!==m?m:(0,C.E)("pending"));return(0,q.a)(r=>{L.bl.get({url:Z},r)},A,null==g?void 0:g.cores),(0,w.jsx)(M.D,{title:"Device Cores",pageSession:f,children:(0,w.jsx)(F.V,{integratedChat:!0,itemData:_,rowIcon:S.x,sourceUrl:V,initialItems:u,numColumnsForm:1,entityName:"devicecores",name:"core",onAdd:r=>r,onEdit:r=>r,columns:N.Z.columns(N.Z.column("name",r=>r.name,"name"),N.Z.column("sdk",r=>r.sdk,"sdk",r=>{var m;return(0,w.jsx)("div",{style:{gap:"5px",display:"flex",flexDirection:"row"},children:null===(m=r.sdks)||void 0===m?void 0:m.map(r=>(0,w.jsx)(O.A,{text:r,color:"$gray5"}))})})),extraFieldsForms:{sdks:I.z.array(I.z.union([I.z.literal(""),I.z.literal("")])).generateOptions(()=>E.isLoaded?E.data.items.map(r=>B.load(r).getData()).map(r=>r.name):[]).after("name").display()},model:R,pageState:h,icons:W,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,G.eq)(V,["admin"],{},async()=>({sdks:await L.bl.get(Z)}))},K=h(66132);let Y=T.V_.object({name:I.z.string().hint("ESP32S3, CHUWI, Arduino UNO...").static().id(),core:I.z.string().hidden(),ports:I.z.array(I.z.record(I.z.string(),I.z.any())),config:I.z.record(I.z.string(),I.z.any())}),X=P.$.createDerived("DeviceBoardModel",Y),J={name:A.V,core:E.S},Q="/adminapi/v1/deviceboards",tt="/adminapi/v1/devicecores?all=1";var te={component:r=>{var m;let{pageState:h,initialItems:u,itemData:_,pageSession:f,extraData:g}=r,[S,E]=(0,H.useState)(null!==(m=null==g?void 0:g.cores)&&void 0!==m?m:(0,C.E)("pending"));return(0,q.a)(r=>{L.bl.get({url:tt},r)},E,null==g?void 0:g.cores),(0,w.jsx)(M.D,{title:"Device Boards",pageSession:f,children:(0,w.jsx)(F.V,{integratedChat:!0,entityName:"deviceboards",itemData:_,rowIcon:K.b,sourceUrl:Q,initialItems:u,numColumnsForm:1,name:"board",onAdd:r=>r,onEdit:r=>r,columns:N.Z.columns(N.Z.column("name",r=>r.name,"name"),N.Z.column("core",r=>r.core,"core",r=>(0,w.jsx)(O.A,{text:r.core,color:"$gray5"})),N.Z.column("ports",r=>r.ports,"ports",r=>(0,w.jsx)(O.A,{text:Object.keys(r.ports).length,color:"$gray5"}))),extraFieldsForms:{core:I.z.union(S.isLoaded?S.data.items.map(r=>I.z.literal(R.load(r).getId())):[]).after("name")},model:X,pageState:h,icons:J,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,G.eq)(Q,["admin"],{},async()=>({cores:await L.bl.get(tt)}))},tn=h(40198),ti=h(39608);let ta=T.V_.object({name:I.z.string().hint("Protofy screen controller...").static().id(),board:I.z.string().hidden(),sdk:I.z.string().hidden(),subsystems:I.z.record(I.z.string(),I.z.any()).optional().hidden(),config:I.z.record(I.z.string(),I.z.any()).onCreate("getConfig").onUpdate("getConfig")}),ts=P.$.createDerived("DeviceDefinitionModel",ta);var to=h(51813),tr=h(71932),tc=h(66306),tl=h(16399),td=h(28554),tm=h(67816),th=h(5632),tp=h(96325),tu=h.n(tp);function t_(r){var m;return Object.keys(r).forEach(h=>{r[h]._devicePositioning&&(m={id:h,...r[h]})}),m}function tf(r,m){let h=r.filter(r=>r.source==m);return h[0]}let tg={"elk.algorithm":"layered","elk.layered.considerModelOrder.strategy":"NODES_AND_EDGES","elk.hierarchyHandling":"SEPARATE_CHILDREN","elk.layered.crossingMinimization.forceNodeModelOrder":!0,"elk.layered.crossingMinimization.strategy":"LAYER_SWEEP","elk.layered.spacing.nodeNodeBetweenLayers":"150","elk.spacing.nodeNode":"100"},ty=function(r){var m;arguments.length>1&&void 0!==arguments[1]&&arguments[1];let h=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0;return{layoutOptions:(null===(m=r.children)||void 0===m?void 0:m.length)?tg:{},id:r.id,width:r.width,height:r.height,children:r.children?r.children.map((r,m)=>ty(r,m,h,u)):[]}},tb=(r,m,h,u)=>{var _=u;let f=t_(m);if(r.id!=(null==f?void 0:f.id)){let m=tf(h,r.id);_=f._devicePositioning.filter(r=>{if(r)return r.includes(m.targetHandle.split("element-")[1])})[0].split("-")[1]}return _},tv=(r,m,h,u,_)=>{let f=m.filter(m=>tb(m,h,u,r)==r).map(r=>ty(r,0,u,h)),g={id:"root",layoutOptions:{...tg,"elk.direction":"l"==r?"LEFT":"RIGHT"},children:f,edges:u.filter(r=>f.find(m=>m.id==r.source)&&f.find(m=>m.id==r.target)&&_.find(m=>m&&m.id==r.source)&&_.find(m=>m&&m.id==r.target)).sort((r,m)=>{let h=r.targetHandle.split("_"),u=m.targetHandle.split("_"),_=h[h.length-1],f=u[u.length-1];if(_.startsWith("block")&&f.startsWith("block")&&r.target==m.target){let r=parseInt(_.substr(5),10),m=parseInt(f.substr(5),10);return r-m}return 0}).map((r,m)=>({id:r.id,sources:[r.source],targets:[r.target]}))};return g},tw=async(r,m,h,u)=>{let _=new(tu()),f=r=>{let h=[],u=(r,_)=>{let f={...r,data:{...r.data}};if(delete f.children,_&&(f.parentNode=_),h.push(f),r.children&&r.children.length){let h=m.find(m=>m.source==r.children[0].id);if(h){let u=JSON.parse(JSON.stringify(h));u.source=r.id,u.sourceHandle=r.id+"-output",m.push(u)}r.children.forEach(m=>u(m,r.id))}};return r.forEach(r=>u(r,null)),h},g=f(r),w=tv("l",r,u,m,g),S=tv("r",r,u,m,g);try{await _.layout(w),await _.layout(S)}catch(r){console.error("Error in layout: ",r)}var E={};let A=(r,m,u)=>r.forEach(r=>{let _=g.find(m=>m.id==r.id);if(_){E[_.id]={layouted:!0,outputPos:u};let f=r.x-m,g=r.y;_.position={x:_.id==h.id?0:f,y:_.id==h.id?0:g},r.children&&r.children.length&&(_.data.height=r.height,_.data.width=r.width)}r&&r.children&&A(r.children,m,u)}),T=S.children.reduce((r,m)=>Math.max(m.x+m.width-150,r),0);return A(S.children,T,"right"),A(w.children,-150,"left"),{nodes:g,edges:m,metadata:E}};var tx=tw;let tS="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _fs-1 _fg-1 _miw-10037 ",tE={name:A.V,board:K.b},tA="/adminapi/v1/devicedefinitions",tT="/adminapi/v1/deviceboards?all=1",tI="/adminapi/v1/devicecores?all=1";var tP={component:r=>{var m,h;let{workspace:u,pageState:_,initialItems:f,itemData:g,pageSession:S,extraData:E}=r,[A,T]=H.useState(!1),{resolvedTheme:P}=(0,tl.P)(),D={components:'[\n "mydevice",\n "esp32dev",\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n];\n\n'},[G,z]=(0,H.useState)(D.components),[U,B]=H.useState({}),W=(0,th.useRouter)(),[V,Z]=(0,H.useState)(null!==(m=null==E?void 0:E.boards)&&void 0!==m?m:(0,C.E)("pending"));(0,q.a)(r=>{L.bl.get({url:tT},r)},Z,null==E?void 0:E.deviceDefinitions);let $=V.isLoaded?V.data.items.map(r=>X.load(r).getData()):[],[K,Y]=(0,H.useState)(null!==(h=null==E?void 0:E.cores)&&void 0!==h?h:(0,C.E)("pending"));(0,q.a)(r=>{L.bl.get({url:tI},r)},Y,null==E?void 0:E.cores);let J=K.isLoaded?K.data.items.map(r=>R.load(r).getData()):[];return(0,w.jsxs)(M.D,{title:"Device Definitions",workspace:u,pageSession:S,children:[(0,w.jsx)(to.a,{open:A,setOpen:r=>{T(r)},hideAccept:!0,style:{width:"80%",height:"80%",padding:"0px",overflow:"hidden"},children:(0,w.jsx)("div",{className:tS,children:(0,w.jsx)(td.Z,{style:{width:"100%"},disableDots:!1,hideBaseComponents:!0,disableStart:!0,autoFitView:!0,getFirstNode:r=>r.find(r=>"ArrayLiteralExpression"==r.type),showActionsBar:!1,layout:tx,customComponents:(0,tm.B)(W.pathname,W.query),bridgeNode:!1,setSourceCode:r=>{console.log("set new sourcecode from flows: ",r),z(r)},sourceCode:G,themeMode:P,config:{masks:(0,tm.W)(W.pathname,W.query),layers:[]},bgColor:"transparent",dataNotify:r=>{r.notifyId},onEdit:r=>U.setData({components:r}),positions:[],disableSideBar:!0,display:!0,flowId:"flows-editor"},"flow")})}),(0,w.jsx)(F.V,{integratedChat:!0,entityName:"devicedefinitions",itemData:g,rowIcon:tn.p,sourceUrl:tA,initialItems:f,numColumnsForm:1,name:"Definition",onAdd:r=>(console.log("DATA (onAdd): ",r),r),onEdit:r=>(console.log("DATA (onEdit): ",r),r),columns:N.Z.columns(N.Z.column("",()=>"",!1,r=>(0,w.jsx)(tr.z,{onPress:async m=>{T(!0),z(r.config.components)},Icon:ti.b}),!0,"50px"),N.Z.column("name",r=>r.name,"name"),N.Z.column("board",r=>r.board,"board",r=>(0,w.jsx)(O.A,{text:r.board,color:"$gray5"})),N.Z.column("sdk",r=>r.sdk,"sdk",r=>(0,w.jsx)(O.A,{text:r.sdk,color:"$gray5"}))),extraFieldsForms:{board:I.z.union($.map(r=>I.z.literal(r.name))).after("name"),sdk:I.z.union([I.z.any(),I.z.any()]).dependsOn("board").generateOptions(r=>{if(r.board){let m=$.find(m=>m.name===r.board);return J.find(r=>r.name===m.core).sdks}return[]}).after("name")},extraFieldsFormsAdd:{device:I.z.boolean().after("config").label("automatic device").defaultValue(!0)},model:ts,pageState:_,icons:tE,dataTableGridProps:{itemMinWidth:300,spacing:20},customFields:{config:{component:(r,m,h,u)=>"preview"==u?(0,w.jsx)(w.Fragment,{}):(0,w.jsx)(tc.zx,{style:{width:"100%"},onPress:_=>{T(!0),"add"==u?z(D.components):z(m.components),B({path:r,data:m,setData:h,mode:u})},children:"Edit"}),hideLabel:!1}}})]})},getServerSideProps:(0,G.eq)(tA,["admin"],{},async()=>({boards:await L.bl.get(tT),cores:await L.bl.get(tI)}))};h(76649);var tD=h(15230),tR=h(1940),tC=h(52026);let tk=H.forwardRef((r,m)=>{let{textColor:h,fontFamily:u="$silkscreen",..._}=r;return(0,w.jsx)(tc.zx,{ref:m,borderRadius:"$10",size:"$3",elevate:!0,space:"$3",..._,children:(0,w.jsx)(tC.Text,{color:h,fontFamily:u,display:"flex",alignItems:"center",children:_.children})})});var tq=tk,tL=h(8939),tM=h(91838);let tF="  is_Separator _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _btc-2122800589 _brc-2122800589 _bbc-2122800589 _blc-2122800589 _btw-0px _brw-0px _bbw-1px _blw-0px _fg-1 _h-0px _mah-0px _mt-15px _mb-15px _bbs-solid _bts-solid _bls-solid _brs-solid _transform-d0t1394298074 ",tN="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-20px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016171 _ls-167744090 _fos-229441251 _lh-222976604 _ussel-auto font_body ",tO="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-10px ",tj=r=>{let{title:m,subtitle:h,children:u,..._}=r;return(0,w.jsxs)(tL.FA,{px:"$2",pb:"$5",f:1,..._,children:[(0,w.jsx)(tM.I,{children:(0,w.jsxs)("div",{className:tO,children:[(0,w.jsx)("p",{className:tN,children:m}),h]})}),(0,w.jsx)("div",{className:tF}),(0,w.jsx)(tM.I,{children:u})]})};h(30025);var tG=h(96455);class tz{get_info(){let r=this.device.getInfo();return r.usbVendorId&&r.usbProductId?"WebSerial VendorID 0x".concat(r.usbVendorId.toString(16)," ProductID 0x").concat(r.usbProductId.toString(16)):""}get_pid(){return this.device.getInfo().usbProductId}slip_writer(r){let m=0,h=0,u=0;for(h=0;h<r.length;h++)(192===r[h]||219===r[h])&&m++;let _=new Uint8Array(2+m+r.length);for(h=0,_[0]=192,u=1;h<r.length;h++,u++){if(192===r[h]){_[u++]=219,_[u]=220;continue}if(219===r[h]){_[u++]=219,_[u]=221;continue}_[u]=r[h]}return _[u]=192,_}async write(r){let m=this.slip_writer(r);if(this.device.writable){let r=this.device.writable.getWriter();await r.write(m),r.releaseLock()}}_appendBuffer(r,m){let h=new Uint8Array(r.byteLength+m.byteLength);return h.set(new Uint8Array(r),0),h.set(new Uint8Array(m),r.byteLength),h.buffer}slip_reader(r){let m=0,h=0,u=0,_="init";for(;m<r.length;){if("init"===_&&192==r[m]){h=m+1,_="valid_data",m++;continue}if("valid_data"===_&&192==r[m]){u=m-1,_="packet_complete";break}m++}if("packet_complete"!==_)return this.left_over=r,new Uint8Array(0);this.left_over=r.slice(u+2);let f=new Uint8Array(u-h+1),g=0;for(m=h;m<=u;m++,g++){if(219===r[m]&&220===r[m+1]){f[g]=192,m++;continue}if(219===r[m]&&221===r[m+1]){f[g]=219,m++;continue}f[g]=r[m]}let w=f.slice(0,g);return w}async read(){let r,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,u=this.left_over;if(this.left_over=new Uint8Array(0),this.slip_reader_enabled){let r=this.slip_reader(u);if(r.length>0)return r;u=this.left_over,this.left_over=new Uint8Array(0)}if(null==this.device.readable)return this.left_over;let _=this.device.readable.getReader();try{m>0&&(r=setTimeout(function(){_.cancel()},m));do{let{value:r,done:m}=await _.read();if(m)throw this.left_over=u,Error("Timeout");let h=new Uint8Array(this._appendBuffer(u.buffer,r.buffer));u=h}while(u.length<h)}finally{m>0&&clearTimeout(r),_.releaseLock()}return this.slip_reader_enabled?this.slip_reader(u):u}async rawRead(){let r,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0!=this.left_over.length){let r=this.left_over;return this.left_over=new Uint8Array(0),r}if(!this.device.readable)return this.left_over;let h=this.device.readable.getReader();try{m>0&&(r=setTimeout(function(){h.cancel()},m));let{value:u,done:_}=await h.read();if(_)throw Error("Timeout");return u}finally{m>0&&clearTimeout(r),h.releaseLock()}}async setRTS(r){await this.device.setSignals({requestToSend:r}),await this.setDTR(this._DTR_state)}async setDTR(r){this._DTR_state=r,await this.device.setSignals({dataTerminalReady:r})}async connect(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:115200;await this.device.open({baudRate:r}),this.baudrate=r,this.left_over=new Uint8Array(0)}async sleep(r){return new Promise(m=>setTimeout(m,r))}async waitForUnlock(r){for(;this.device.readable&&this.device.readable.locked||this.device.writable&&this.device.writable.locked;)await this.sleep(r)}async disconnect(){await this.waitForUnlock(400),await this.device.close()}constructor(r){this.device=r,this.slip_reader_enabled=!1,this.left_over=new Uint8Array(0),this.baudrate=0,this._DTR_state=!1}}class tU extends Error{}var tB=h(32845);async function tH(r){switch(r){case 15736195:{let{ESP32ROM:r}=await h.e(1568).then(h.bind(h,91568));return new r}case 1763790959:case 456216687:{let{ESP32C3ROM:r}=await h.e(5867).then(h.bind(h,65867));return new r}case 9:{let{ESP32S3ROM:r}=await h.e(5963).then(h.bind(h,15963));return new r}case 1990:{let{ESP32S2ROM:r}=await h.e(2579).then(h.bind(h,2579));return new r}case 4293968129:{let{ESP8266ROM:r}=await h.e(90).then(h.bind(h,40090));return new r}default:return null}}class tW{_sleep(r){return new Promise(m=>setTimeout(m,r))}write(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.terminal?m?this.terminal.writeLine(r):this.terminal.write(r):console.log(r)}error(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write("Error: ".concat(r),m)}info(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write(r,m)}debug(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.debugLogging&&this.write("Debug: ".concat(r),m)}_short_to_bytearray(r){return new Uint8Array([255&r,r>>8&255])}_int_to_bytearray(r){return new Uint8Array([255&r,r>>8&255,r>>16&255,r>>24&255])}_bytearray_to_short(r,m){return r|m>>8}_bytearray_to_int(r,m,h,u){return r|m<<8|h<<16|u<<24}_appendBuffer(r,m){let h=new Uint8Array(r.byteLength+m.byteLength);return h.set(new Uint8Array(r),0),h.set(new Uint8Array(m),r.byteLength),h.buffer}_appendArray(r,m){let h=new Uint8Array(r.length+m.length);return h.set(r,0),h.set(m,r.length),h}ui8ToBstr(r){let m="";for(let h=0;h<r.length;h++)m+=String.fromCharCode(r[h]);return m}bstrToUi8(r){let m=new Uint8Array(r.length);for(let h=0;h<r.length;h++)m[h]=r.charCodeAt(h);return m}async flush_input(){try{await this.transport.rawRead(200)}catch(r){this.error(r.message)}}async command(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uint8Array(0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=!(arguments.length>3)||void 0===arguments[3]||arguments[3],_=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;if(null!=r){let u;let _=new Uint8Array(8+m.length);for(u=0,_[0]=0,_[1]=r,_[2]=this._short_to_bytearray(m.length)[0],_[3]=this._short_to_bytearray(m.length)[1],_[4]=this._int_to_bytearray(h)[0],_[5]=this._int_to_bytearray(h)[1],_[6]=this._int_to_bytearray(h)[2],_[7]=this._int_to_bytearray(h)[3];u<m.length;u++)_[8+u]=m[u];await this.transport.write(_)}if(!u)return[0,new Uint8Array(0)];for(let m=0;m<100;m++){let m=await this.transport.read(_),h=m[0],u=m[1],f=this._bytearray_to_int(m[4],m[5],m[6],m[7]),g=m.slice(8);if(1==h){if(null==r||u==r)return[f,g];if(0!=g[0]&&g[1]==this.ROM_INVALID_RECV_MSG)throw await this.flush_input(),new tU("unsupported command error")}}throw new tU("invalid response")}async read_reg(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,h=this._int_to_bytearray(r),u=await this.command(this.ESP_READ_REG,h,void 0,void 0,m);return u[0]}async write_reg(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967295,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,_=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));f=this._appendArray(f,this._int_to_bytearray(h)),f=this._appendArray(f,this._int_to_bytearray(u)),_>0&&(f=this._appendArray(f,this._int_to_bytearray(this.chip.UART_DATE_REG_ADDR)),f=this._appendArray(f,this._int_to_bytearray(0)),f=this._appendArray(f,this._int_to_bytearray(0)),f=this._appendArray(f,this._int_to_bytearray(_))),await this.check_command("write target memory",this.ESP_WRITE_REG,f)}async sync(){let r;this.debug("Sync");let m=new Uint8Array(36);for(r=0,m[0]=7,m[1]=7,m[2]=18,m[3]=32;r<32;r++)m[4+r]=85;try{let r=await this.command(8,m,void 0,void 0,100);return r}catch(r){throw this.debug("Sync err "+r),r}}async _connect_attempt(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.debug("_connect_attempt "+r+" "+m),"no_reset"!==r&&(this.transport.get_pid()===this.USB_JTAG_SERIAL_PID?(await this.transport.setRTS(!1),await this.transport.setDTR(!1),await this._sleep(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(100),await this.transport.setRTS(!0),await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)):(await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),m&&await this._sleep(2e3),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(50)),await this.transport.setDTR(!1));let h=0,u=!0;for(;u;){try{let r=await this.transport.read(1e3);h+=r.length}catch(r){if(this.debug(r.message),r instanceof Error){u=!1;break}}await this._sleep(50)}for(this.transport.slip_reader_enabled=!0,h=7;h--;){try{let r=await this.sync();return this.debug(r[0].toString()),"success"}catch(r){r instanceof Error&&(m?this.info("_",!1):this.info(".",!1))}await this._sleep(50)}return"error"}async connect(){let r,m,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,_=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(this.info("Connecting...",!1),await this.transport.connect(this.rom_baudrate),r=0;r<u&&"success"!==(m=await this._connect_attempt(h,!1))&&"success"!==(m=await this._connect_attempt(h,!0));r++);if("success"!==m)throw new tU("Failed to connect with the device");if(this.info("\n\r",!1),!_){let r=await this.read_reg(1073745920)>>>0;this.debug("Chip Magic "+r.toString(16));let m=await tH(r);if(null===this.chip)throw new tU("Unexpected CHIP magic value ".concat(r,". Failed to autodetect chip type."));this.chip=m}}async detect_chip(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.connect(r),this.info("Detecting chip type... ",!1),null!=this.chip?this.info(this.chip.CHIP_NAME):this.info("unknown!")}async check_command(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Uint8Array(0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,_=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;this.debug("check_command "+r);let f=await this.command(m,h,u,void 0,_);return f[1].length>4?f[1]:f[0]}async mem_begin(r,m,h,u){this.debug("mem_begin "+r+" "+m+" "+h+" "+u.toString(16));let _=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));_=this._appendArray(_,this._int_to_bytearray(h)),_=this._appendArray(_,this._int_to_bytearray(u)),await this.check_command("enter RAM download mode",this.ESP_MEM_BEGIN,_)}async mem_block(r,m){let h=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,r);let u=this.checksum(r);await this.check_command("write to target RAM",this.ESP_MEM_DATA,h,u)}async mem_finish(r){let m=0===r?1:0,h=this._appendArray(this._int_to_bytearray(m),this._int_to_bytearray(r));await this.check_command("leave RAM download mode",this.ESP_MEM_END,h,void 0,50)}async flash_spi_attach(r){let m=this._int_to_bytearray(r);await this.check_command("configure SPI flash pins",this.ESP_SPI_ATTACH,m)}async flash_begin(r,m){let h=Math.floor((r+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),u=this.chip.get_erase_size(m,r),_=new Date,f=_.getTime(),g=3e3;!1==this.IS_STUB&&(g=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,r)),this.debug("flash begin "+u+" "+h+" "+this.FLASH_WRITE_SIZE+" "+m+" "+r);let w=this._appendArray(this._int_to_bytearray(u),this._int_to_bytearray(h));w=this._appendArray(w,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),w=this._appendArray(w,this._int_to_bytearray(m)),!1==this.IS_STUB&&(w=this._appendArray(w,this._int_to_bytearray(0))),await this.check_command("enter Flash download mode",this.ESP_FLASH_BEGIN,w,void 0,g);let S=_.getTime();return 0!=r&&!1==this.IS_STUB&&this.info("Took "+(S-f)/1e3+"."+(S-f)%1e3+"s to erase flash block"),h}async flash_defl_begin(r,m,h){let u,_;let f=Math.floor((m+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),g=Math.floor((r+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),w=new Date,S=w.getTime();this.IS_STUB?(u=r,_=3e3):(u=g*this.FLASH_WRITE_SIZE,_=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,u)),this.info("Compressed "+r+" bytes to "+m+"...");let E=this._appendArray(this._int_to_bytearray(u),this._int_to_bytearray(f));E=this._appendArray(E,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),E=this._appendArray(E,this._int_to_bytearray(h)),("ESP32-S2"===this.chip.CHIP_NAME||"ESP32-S3"===this.chip.CHIP_NAME||"ESP32-C3"===this.chip.CHIP_NAME)&&!1===this.IS_STUB&&(E=this._appendArray(E,this._int_to_bytearray(0))),await this.check_command("enter compressed flash mode",this.ESP_FLASH_DEFL_BEGIN,E,void 0,_);let A=w.getTime();return 0!=r&&!1===this.IS_STUB&&this.info("Took "+(A-S)/1e3+"."+(A-S)%1e3+"s to erase flash block"),f}async flash_block(r,m,h){let u=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,r);let _=this.checksum(r);await this.check_command("write to target Flash after seq "+m,this.ESP_FLASH_DATA,u,_,h)}async flash_defl_block(r,m,h){let u=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,r);let _=this.checksum(r);this.debug("flash_defl_block "+r[0].toString(16)+" "+r[1].toString(16)),await this.check_command("write compressed data to flash after seq "+m,this.ESP_FLASH_DEFL_DATA,u,_,h)}async flash_finish(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=r?0:1,h=this._int_to_bytearray(m);await this.check_command("leave Flash mode",this.ESP_FLASH_END,h)}async flash_defl_finish(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=r?0:1,h=this._int_to_bytearray(m);await this.check_command("leave compressed flash mode",this.ESP_FLASH_DEFL_END,h)}async run_spiflash_command(r,m,h){let u,_;let f=-2147483648,g=268435456,w=134217728,S=this.chip.SPI_REG_BASE,E=S+0,A=S+this.chip.SPI_USR_OFFS,T=S+this.chip.SPI_USR1_OFFS,I=S+this.chip.SPI_USR2_OFFS,P=S+this.chip.SPI_W0_OFFS;u=null!=this.chip.SPI_MOSI_DLEN_OFFS?async(r,m)=>{let h=S+this.chip.SPI_MOSI_DLEN_OFFS,u=S+this.chip.SPI_MISO_DLEN_OFFS;r>0&&await this.write_reg(h,r-1),m>0&&await this.write_reg(u,m-1)}:async(r,m)=>{let h=T,u=17,_=8,f=0===r?0:r-1,g=0===m?0:m-1,w=g<<_|f<<u;await this.write_reg(h,w)};let D=262144,R=28;if(h>32)throw new tU("Reading more than 32 bits back from a SPI flash operation is unsupported");if(m.length>64)throw new tU("Writing more than 64 bytes of data with one SPI command is unsupported");let C=8*m.length,q=await this.read_reg(A),L=await this.read_reg(I),M=f;h>0&&(M|=g),C>0&&(M|=w),await u(C,h),await this.write_reg(A,M);let F=7<<R|r;if(await this.write_reg(I,F),0==C)await this.write_reg(P,0);else{if(m.length%4!=0){let r=new Uint8Array(m.length%4);m=this._appendArray(m,r)}let r=P;for(_=0;_<m.length-4;_+=4)F=this._bytearray_to_int(m[_],m[_+1],m[_+2],m[_+3]),await this.write_reg(r,F),r+=4}for(await this.write_reg(E,D),_=0;_<10&&0!=(F=await this.read_reg(E)&D);_++);if(10===_)throw new tU("SPI command did not complete in time");let N=await this.read_reg(P);return await this.write_reg(A,q),await this.write_reg(I,L),N}async read_flash_id(){let r=159,m=new Uint8Array(0);return await this.run_spiflash_command(r,m,24)}async erase_flash(){this.info("Erasing flash (this may take a while)...");let r=new Date,m=r.getTime(),h=await this.check_command("erase flash",this.ESP_ERASE_FLASH,void 0,void 0,this.CHIP_ERASE_TIMEOUT);r=new Date;let u=r.getTime();return this.info("Chip erase completed successfully in "+(u-m)/1e3+"s"),h}toHex(r){return Array.prototype.map.call(r,r=>("00"+r.toString(16)).slice(-2)).join("")}async flash_md5sum(r,m){let h=this.timeout_per_mb(this.MD5_TIMEOUT_PER_MB,m),u=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0));let _=await this.check_command("calculate md5sum",this.ESP_SPI_FLASH_MD5,u,void 0,h);_ instanceof Uint8Array&&_.length>16&&(_=_.slice(0,16));let f=this.toHex(_);return f}async run_stub(){let r;this.info("Uploading stub...");let m=atob(this.chip.ROM_TEXT),h=m.split("").map(function(r){return r.charCodeAt(0)}),u=new Uint8Array(h);h=(m=atob(this.chip.ROM_DATA)).split("").map(function(r){return r.charCodeAt(0)});let _=new Uint8Array(h),f=Math.floor((u.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);for(await this.mem_begin(u.length,f,this.ESP_RAM_BLOCK,this.chip.TEXT_START),r=0;r<f;r++){let m=r*this.ESP_RAM_BLOCK,h=m+this.ESP_RAM_BLOCK;await this.mem_block(u.slice(m,h),r)}for(f=Math.floor((_.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK),await this.mem_begin(_.length,f,this.ESP_RAM_BLOCK,this.chip.DATA_START),r=0;r<f;r++){let m=r*this.ESP_RAM_BLOCK,h=m+this.ESP_RAM_BLOCK;await this.mem_block(_.slice(m,h),r)}this.info("Running stub..."),await this.mem_finish(this.chip.ENTRY);for(let r=0;r<100;r++){let r=await this.transport.read(1e3,6);if(79===r[0]&&72===r[1]&&65===r[2]&&73===r[3])return this.info("Stub running..."),this.IS_STUB=!0,this.FLASH_WRITE_SIZE=16384,this.chip}throw new tU("Failed to start stub. Unexpected response")}async change_baud(){this.info("Changing baudrate to "+this.baudrate);let r=this.IS_STUB?this.transport.baudrate:0,m=this._appendArray(this._int_to_bytearray(this.baudrate),this._int_to_bytearray(r)),h=await this.command(this.ESP_CHANGE_BAUDRATE,m);this.debug(h[0].toString()),this.info("Changed"),await this.transport.disconnect(),await this._sleep(50),await this.transport.connect(this.baudrate);try{await this.transport.rawRead(500)}catch(r){this.debug(r.message)}}async main_fn(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.detect_chip(r);let m=await this.chip.get_chip_description(this);return this.info("Chip is "+m),this.info("Features: "+await this.chip.get_chip_features(this)),this.info("Crystal is "+await this.chip.get_crystal_freq(this)+"MHz"),this.info("MAC: "+await this.chip.read_mac(this)),await this.chip.read_mac(this),void 0!==this.chip._post_connect&&await this.chip._post_connect(this),await this.run_stub(),this.rom_baudrate!==this.baudrate&&await this.change_baud(),m}parse_flash_size_arg(r){if(void 0===this.chip.FLASH_SIZES[r])throw new tU("Flash size "+r+" is not supported by this chip type. Supported sizes: "+this.chip.FLASH_SIZES);return this.chip.FLASH_SIZES[r]}_update_image_flash_params(r,m,h,u,_){if(this.debug("_update_image_flash_params "+h+" "+u+" "+_),r.length<8||m!=this.chip.BOOTLOADER_FLASH_OFFSET)return r;if("keep"===h&&"keep"===u&&"keep"===_)return this.info("Not changing the image"),r;let f=parseInt(r[0]),g=parseInt(r[2]),w=parseInt(r[3]);if(f!==this.ESP_IMAGE_MAGIC)return this.info("Warning: Image file at 0x"+m.toString(16)+" doesn't look like an image file, so not changing any flash settings."),r;if("keep"!==u){let r={qio:0,qout:1,dio:2,dout:3};g=r[u]}let S=15&w;if("keep"!==_){let r={"40m":0,"26m":1,"20m":2,"80m":15};S=r[_]}let E=240&w;"keep"!==h&&(E=this.parse_flash_size_arg(h));let A=g<<8|S+E;return this.info("Flash params set to "+A.toString(16)),parseInt(r[2])!==g<<8&&(r=r.substring(0,2)+(g<<8).toString()+r.substring(3)),parseInt(r[3])!==S+E&&(r=r.substring(0,3)+(S+E).toString()+r.substring(4)),r}async write_flash(r){let m,h,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keep",_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"keep",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keep",g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=!(arguments.length>5)||void 0===arguments[5]||arguments[5],S=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0;if(this.debug("EspLoader program"),"keep"!==u){let m=this.flash_size_bytes(u);for(let h=0;h<r.length;h++)if(r[h].data.length+r[h].address>m)throw new tU("File ".concat(h+1," doesn't fit in the available flash"))}!0===this.IS_STUB&&!0===g&&await this.erase_flash();for(let g=0;g<r.length;g++){let A;this.debug("Data Length "+r[g].data.length),m=r[g].data;let T=r[g].data.length%4;if(T>0&&(m+="\xff\xff\xff\xff".substring(4-T)),h=r[g].address,this.debug("Image Length "+m.length),0===m.length){this.debug("Warning: File is empty");continue}m=this._update_image_flash_params(m,h,u,_,f);let I=null;E&&(I=E(m),this.debug("Image MD5 "+I));let P=m.length;if(w){let r=this.bstrToUi8(m);m=this.ui8ToBstr((0,tB.deflate)(r,{level:9})),A=await this.flash_defl_begin(P,m.length,h)}else A=await this.flash_begin(P,h);let D=0,R=0,C=m.length;S&&S(g,0,C);let q=new Date,L=q.getTime(),M=5e3,F=new tB.Inflate({chunkSize:1}),N=0;for(F.onData=function(r){N+=r.byteLength};m.length>0;){this.debug("Write loop "+h+" "+D+" "+A),this.info("Writing at 0x"+(h+N).toString(16)+"... ("+Math.floor(100*(D+1)/A)+"%)");let r=this.bstrToUi8(m.slice(0,this.FLASH_WRITE_SIZE));if(w){let m=N;F.push(r,!1);let h=N-m,u=3e3;this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)>3e3&&(u=this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)),!1===this.IS_STUB&&(M=u),await this.flash_defl_block(r,D,M),this.IS_STUB&&(M=u)}else throw new tU("Yet to handle Non Compressed writes");R+=r.length,m=m.slice(this.FLASH_WRITE_SIZE,m.length),D++,S&&S(g,R,C)}this.IS_STUB&&await this.read_reg(this.CHIP_DETECT_MAGIC_REG_ADDR,M),q=new Date;let O=q.getTime()-L;if(w&&this.info("Wrote "+P+" bytes ("+R+" compressed) at 0x"+h.toString(16)+" in "+O/1e3+" seconds."),I){let r=await this.flash_md5sum(h,P);if(new String(r).valueOf()!=new String(I).valueOf())throw this.info("File  md5: "+I),this.info("Flash md5: "+r),new tU("MD5 of file does not match data in flash!");this.info("Hash of data verified.")}}this.info("Leaving..."),this.IS_STUB&&(await this.flash_begin(0,0),w?await this.flash_defl_finish():await this.flash_finish())}async flash_id(){this.debug("flash_id");let r=await this.read_flash_id();this.info("Manufacturer: "+(255&r).toString(16));let m=r>>16&255;this.info("Device: "+(r>>8&255).toString(16)+m.toString(16)),this.info("Detected flash size: "+this.DETECTED_FLASH_SIZES[m])}async hard_reset(){await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)}async soft_reset(){if(this.IS_STUB){if("ESP8266"!=this.chip.CHIP_NAME)throw new tU("Soft resetting is currently only supported on ESP8266");await this.command(this.ESP_RUN_USER_CODE,void 0,void 0,!1)}else await this.flash_begin(0,0),await this.flash_finish(!1)}constructor(r,m,h,u=115200,_=!1){this.transport=r,this.baudrate=m,this.terminal=h,this.rom_baudrate=u,this.debugLogging=_,this.ESP_RAM_BLOCK=6144,this.ESP_FLASH_BEGIN=2,this.ESP_FLASH_DATA=3,this.ESP_FLASH_END=4,this.ESP_MEM_BEGIN=5,this.ESP_MEM_END=6,this.ESP_MEM_DATA=7,this.ESP_WRITE_REG=9,this.ESP_READ_REG=10,this.ESP_SPI_ATTACH=13,this.ESP_CHANGE_BAUDRATE=15,this.ESP_FLASH_DEFL_BEGIN=16,this.ESP_FLASH_DEFL_DATA=17,this.ESP_FLASH_DEFL_END=18,this.ESP_SPI_FLASH_MD5=19,this.ESP_ERASE_FLASH=208,this.ESP_ERASE_REGION=209,this.ESP_RUN_USER_CODE=211,this.ESP_IMAGE_MAGIC=233,this.ESP_CHECKSUM_MAGIC=239,this.ROM_INVALID_RECV_MSG=5,this.ERASE_REGION_TIMEOUT_PER_MB=3e4,this.ERASE_WRITE_TIMEOUT_PER_MB=4e4,this.MD5_TIMEOUT_PER_MB=8e3,this.CHIP_ERASE_TIMEOUT=12e4,this.MAX_TIMEOUT=2*this.CHIP_ERASE_TIMEOUT,this.CHIP_DETECT_MAGIC_REG_ADDR=1073745920,this.DETECTED_FLASH_SIZES={18:"256KB",19:"512KB",20:"1MB",21:"2MB",22:"4MB",23:"8MB",24:"16MB"},this.USB_JTAG_SERIAL_PID=4097,this.checksum=function(r){let m;let h=239;for(m=0;m<r.length;m++)h^=r[m];return h},this.timeout_per_mb=function(r,m){let h=r*(m/1e6);return h<3e3?3e3:h},this.flash_size_bytes=function(r){let m=-1;return -1!==r.indexOf("KB")?m=1024*parseInt(r.slice(0,r.indexOf("KB"))):-1!==r.indexOf("MB")&&(m=1048576*parseInt(r.slice(0,r.indexOf("MB")))),m},this.IS_STUB=!1,this.FLASH_WRITE_SIZE=16384,this.terminal&&this.terminal.clean(),this.info("esptool.js"),this.info("Serial port "+this.transport.get_info())}}let tV=r=>new Promise(m=>setTimeout(m,r));!function(r){r.INITIALIZING="initializing",r.PREPARING="preparing",r.ERASING="erasing",r.WRITING="writing",r.FINISHED="finished",r.ERROR="error"}(_||(_={})),function(r){r.FAILED_INITIALIZING="failed_initialize",r.FAILED_MANIFEST_FETCH="fetch_manifest_failed",r.NOT_SUPPORTED="not_supported",r.FAILED_FIRMWARE_DOWNLOAD="failed_firmware_download",r.WRITE_FAILED="write_failed"}(f||(f={}));let tZ={builds:[{chipFamily:"ESP32",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32/esphome-web-esp32.bin",offset:0}]},{chipFamily:"ESP32-C3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32c3/esphome-web-esp32c3.bin",offset:0}]},{chipFamily:"ESP32-S2",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s2/esphome-web-esp32s2.bin",offset:0}]},{chipFamily:"ESP32-S3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s3/esphome-web-esp32s3.bin",offset:0}]},{chipFamily:"ESP8266",parts:[{path:"https://firmware.esphome.io/esphome-web-esp8266/esphome-web-esp8266.bin",offset:0}]}]},t$=async r=>{await r.device.setSignals({dataTerminalReady:!1,requestToSend:!0}),await r.device.setSignals({dataTerminalReady:!1,requestToSend:!1})},tK=async()=>{let r=!0;try{u=await navigator.serial.requestPort()}catch(m){return m.name,r}if(!u)return r;try{await u.open({baudRate:115200})}catch(m){return r}},tY=async(r,m,h)=>{let _,g;r({message:'Please hold "Boot" button of your ESP32 board.'});let w=new tz(u),S=new tW(w,115200,void 0);await u.close(),window.esploader=S;try{await S.main_fn()}catch(m){throw console.error(m),r({message:"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL.",details:{error:f.FAILED_INITIALIZING,details:m}}),await t$(w),await w.disconnect(),"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL."}if(console.log("chipFamily: ",g=S.chip.CHIP_NAME),!S.chip.ROM_TEXT)throw r({message:"Chip ".concat(g," is not supported"),details:{error:f.NOT_SUPPORTED,details:"Chip ".concat(g," is not supported")}}),await t$(w),await w.disconnect(),"Chip ".concat(g," is not supported");if(r({message:"Initialized. Found ".concat(g),details:{done:!0}}),!(_=tZ.builds.find(r=>r.chipFamily===g)))throw r({message:"Your ".concat(g," board is not supported."),details:{error:f.NOT_SUPPORTED,details:g}}),await t$(w),await w.disconnect(),"Your ".concat(g," board is not supported.");r({message:"Preparing installation...",details:{done:!1}});let E=_.parts.map(async r=>{let u=tQ(m,h),_=await fetch(u);if(!_.ok)throw Error("Downlading firmware ".concat(u," failed: ").concat(_.status));let f=new FileReader,g=await _.blob();return new Promise(r=>{f.addEventListener("load",()=>r(f.result)),f.readAsBinaryString(g)})}),A=[],T=0;for(let m=0;m<E.length;m++)try{let r=await E[m];A.push({data:r,address:_.parts[m].offset}),T+=r.length}catch(m){r({message:m.message,details:{error:f.FAILED_FIRMWARE_DOWNLOAD,details:m.message}}),await t$(w),await w.disconnect();return}r({message:"Installation prepared",details:{done:!0}}),r({message:"Erasing device...",details:{done:!1}}),await S.erase_flash(),r({message:"Device erased",details:{done:!0}}),r({message:"Writing progress: 0%",details:{bytesTotal:T,bytesWritten:0,percentage:0}});let I=0;try{await S.write_flash(A,"keep","keep","keep",!1,!0,(m,h,u)=>{let _=h/u*A[m].data.length,f=Math.floor((I+_)/T*100);if(h===u){I+=_;return}r({message:"Writing progress: ".concat(f,"%"),details:{bytesTotal:T,bytesWritten:I+h,percentage:f}})})}catch(m){r({message:m.message,details:{error:f.WRITE_FAILED,details:m}}),await t$(w),await w.disconnect();return}r({message:"Writing complete",details:{bytesTotal:T,bytesWritten:I,percentage:100}}),await tV(100),console.log("HARD RESET"),await t$(w),console.log("DISCONNECT"),await w.disconnect(),r({message:"All done!"})},tX="compile.protofy.xyz",tJ=!0,tQ=(r,m)=>"http".concat(tJ?"s":"","://").concat(tX,"/api/v1/device/download/").concat(r,"?compileSessionId=").concat(m),t0=()=>"ws".concat(tJ?"s":"","://").concat(tX,"/websocket"),t5=r=>"http".concat(tJ?"s":"","://").concat(tX,"/api/v1/device/edit/").concat(r),t3=(r,m)=>"http".concat(tJ?"s":"","://").concat(tX,"/api/v1/device/compile/").concat(r,"?compileSessionId=").concat(m),t6=r=>"device/compile/".concat(r);var t4=h(39684);let t8=r=>{var m,h;let{stage:u,onCancel:_,onSelect:f,showModal:g,modalFeedback:S}=r,E=null==S?void 0:null===(m=S.details)||void 0===m?void 0:m.error,A=["write"].includes(u)&&!E&&!(null==S?void 0:null===(h=S.message)||void 0===h?void 0:h.includes('Please hold "Boot"')),T=(0,tC.useThemeName)(),I={yaml:"Uploading yaml to the project...",compile:"Compiling firmware...",upload:"Connect your device and click select to chose the port. ",write:"Writting firmware to device. Please do not unplug your device.",idle:"Device configured successfully. You can unplug your device."},[P,D]=H.useState(I[u]),R=r=>(0,w.jsx)(tM.I,{children:(0,w.jsx)("a",{target:"_blank",style:{color:"var(--color8)"},onMouseEnter:r=>{r.currentTarget.style.textDecoration="underline"},onMouseLeave:r=>{r.currentTarget.style.textDecoration="none"},...r})}),C=()=>"upload"===u&&!E&&(0,w.jsx)("div",{style:{textAlign:"center",color:E?"red":"",marginTop:"20px",marginBottom:"0px"},children:(0,w.jsxs)(w.Fragment,{children:["Note: If you don't see your device on the menu, download device drivers on ",(0,w.jsx)(R,{href:"https://www.silabs.com/documents/public/software/CP210x_Windows_Drivers.zip",children:"Windows"}),(0,w.jsx)("a",{children:", "}),(0,w.jsx)(R,{href:"https://www.silabs.com/documents/public/software/Mac_OSX_VCP_Driver.zip",children:"Mac"}),(0,w.jsx)("a",{children:" or "}),(0,w.jsx)(R,{href:"https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads",children:"other OS"})]})}),q={compile:"1",upload:"2",write:"3",idle:"4"},L={light:{compile:"/admin/_next/static/media/protofitoCompiling.7548c399.gif",loading:"/admin/_next/static/media/protofitoLoading.b3d41156.gif",idle:"/admin/_next/static/media/protofitoDancing.5a429207.gif"},dark:{compile:"/admin/_next/static/media/protofitoCompilingW.1d28e002.gif",loading:"/admin/_next/static/media/protofitoLoadingW.a84348f3.gif",idle:"/admin/_next/static/media/protofitoDancingW.fa27d98c.gif"}};return(0,w.jsx)(to.a,{open:g,hideAccept:!0,children:(0,w.jsxs)("div",{style:{height:"350px",width:"400px",position:"relative",overflow:"visible",justifyContent:"space-between",display:"flex",flexDirection:"column"},children:[(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,w.jsx)("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:"xs"},children:"[".concat(q[u],"/").concat(Object.keys(q).length,"]")}),(0,w.jsx)("div",{style:{flexGrow:1,textAlign:"center",color:E?"red":"",marginBottom:"0px",marginTop:"2"===q[u]?"100px":"0px"},children:S&&["write","compile","upload"].includes(u)?S.message:P}),(0,w.jsx)(C,{})]}),!E&&L[T][A?"loading":u]?(0,w.jsx)("img",{alt:"protofito dancing",style:{height:A?"200px":"180px",width:A?"300px":"190px",alignSelf:"center",objectFit:"cover",paddingTop:"20px"},src:L[T][A?"loading":u]}):null,(0,w.jsxs)("div",{style:{justifyContent:"center",alignSelf:"center",display:"flex",gap:"20px"},children:["write"!=u&&"idle"!=u||E?(0,w.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"#cccccc40",borderRadius:"10px"},onClick:()=>{_()},children:"Cancel"}):(0,w.jsx)(w.Fragment,{}),"upload"==u?(0,w.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{f()},children:"Select"}):(0,w.jsx)(w.Fragment,{}),"idle"==u?(0,w.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{_()},children:"Done!"}):(0,w.jsx)(w.Fragment,{})]})]})})};var t9=t8;class t7{attach(r,m){let h=[{name:this.type,config:{ssid:this.ssid,password:this.password,power_save_mode:this.power_save_mode}}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}constructor(r,m,h){this.ssid=r,this.password=m,this.power_save_mode=h,this.type="wifi"}}function et(r,m,h){return new t7(r,m,h)}class ee{attach(r,m){this.topic_prefix="devices/"+m.esphome.name;let h=[{name:this.type,config:{broker:this.broker,topic_prefix:this.topic_prefix,port:this.port},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?m[r.name]={...m[r.name],...r.config}:m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,config:{prefix:this.topic_prefix,frontendEndpoint:"/ws",brokerUrl:this.broker},actions:[],monitors:[{name:"status",label:"Device status",description:"Gets the status of the mqtt connection",endpoint:"/status",connectionType:"mqtt"}]}}constructor(r,m){this.broker=r,this.port=m,this.name=this.type="mqtt"}}function en(r,m){return new ee(r,m)}class ei{extractNestedComponents(r,m){let h=[{key:"mqtt",nestedKey:"on_message"},{key:"esphome",nestedKey:"on_boot"}];h.forEach(h=>{let{key:u,nestedKey:_}=h;r.config[_]&&(m[u]||(m[u]={}),m[u][_]||(m[u][_]=[]),Array.isArray(m[u][_])?m[u][_].push(...r.config[_]):m[u][_]={...m[u][_],...r.config[_]})})}exctractComponent(r,m){["mqtt","esphome"].includes(r.name)?this.extractNestedComponents(r,m):m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name].push(r.config)):m[r.name]=r.config}attach(r,m,h){var u,_,f,g;let w=[{name:"deep_sleep",config:{id:"ds",sleep_duration:this.sleep_duration+"s",wakeup_pin:this.wakeup_pin,wakeup_pin_mode:"KEEP_AWAKE"}}],S=[{name:"globals",config:{id:"dp_run_duration",type:"int",restore_value:"yes",initial_value:this.run_duration}},{name:"globals",config:{id:"dp_sleep_duration",type:"int",restore_value:"yes",initial_value:this.sleep_duration}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(u=m.mqtt)||void 0===u?void 0:u.topic_prefix)!==""?(null===(_=m.mqtt)||void 0===_?void 0:_.topic_prefix)+"/"+m.esphome.name:m.esphome.name,"/deep_sleep/dp_sleep_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value == 0) {\n  id(ds).prevent_deep_sleep();\n  ESP_LOGD("Deep Sleep", "Deep Sleep disabled");\n} else if (value > 0) {\n  id(ds).allow_deep_sleep();\n  id(dp_sleep_duration) = value;\n  id(ds).set_sleep_duration(value * 1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep sleep duration set to: %d", value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to: %d", id(dp_run_duration));\n} else {\n  ESP_LOGD("Deep Sleep", "Invalid sleep duration value");\n}'}}]}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(f=m.mqtt)||void 0===f?void 0:f.topic_prefix)!==""?(null===(g=m.mqtt)||void 0===g?void 0:g.topic_prefix)+"/"+m.esphome.name:m.esphome.name,"/deep_sleep/dp_run_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value > 0){\n  id(dp_run_duration) = value;\n  id(ds).set_run_duration(value*1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep run duration set to: %d",  value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to: %d",  id(dp_run_duration));       \n} else {\n  ESP_LOGD("Deep Sleep", "Invalid run duration value");\n}'}}]}},{name:"esphome",config:{on_boot:[{priority:600,then:{lambda:'ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to at boot: %d",  id(dp_run_duration));\nid(ds).set_run_duration(id(dp_run_duration)*1000);\nESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to at boot: %d",  id(dp_sleep_duration));\nid(ds).set_sleep_duration(id(dp_sleep_duration)*1000);'}}]}}];return w.forEach((r,h)=>{this.exctractComponent(r,m)}),h.filter(r=>null!==r).map(r=>r.constructor.name).includes("Mqtt")&&S.forEach((r,h)=>{this.exctractComponent(r,m)}),m}constructor(r,m,h,u){this.run_duration=r,this.sleep_duration=m,this.wakeup_pin=h,this.mqttTopicPrefix=""}}function ea(r,m,h,u){return new ei(r,m,h,u)}class es{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,filters:[{delayed_off:"100ms"},{delayed_on:"100ms"}]},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"status",label:"Button status",description:"Get binary sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m){this.name=r,this.platform=m,this.type="binary_sensor"}}function eo(r){return new es(r,"gpio")}let er=h(49431);class ec{createComponentsTree(r,m){var h,u={...m.config.sdkConfig,logger:{}};u.esphome.name=r,null===(h=this.components)||void 0===h||h.forEach((r,m)=>{console.log("\uD83D\uDE80 ~ file: Device.ts:62 ~ Device ~ this.components?.forEach ~ component:",r),r&&(u=r.attach(isNaN(parseInt(this.pinTable[m]))?this.pinTable[m]:parseInt(this.pinTable[m]),u,this.components))}),this.componentsTree=u}createSubsystemsTree(r,m){var h;this.subsystemsTree=[],null===(h=this.components)||void 0===h||h.forEach(r=>{if(r)try{var m;let h=r.getSubsystem();this.subsystemsTree.push({generateEvent:null===(m=h.generateEvent)||void 0===m||m,...h})}catch(r){}}),this.subsystemsTree=this.subsystemsTree.sort((r,m)=>"mqtt"==r.name?-1:"mqtt"==m.name?1:0)}getComponentsTree(r,m){let h=m.board.ports;return this.pinTable=h.map(r=>r.name),this.createComponentsTree(r,m),this.componentsTree}getSubsystemsTree(r,m){return this.createSubsystemsTree(r,m),this.subsystemsTree}dump(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"yaml";return"yaml"==r?er.dump(this.componentsTree,{lineWidth:-1}):void 0}constructor(r){this.pinTable=[],this.components=r.slice(2),this.componentsTree={},this.subsystemsTree=[]}}function el(r){return new ec(r)}class ed{attach(r,m){var h=!1;this.effects.forEach(r=>{!0===r&&(h=!0)});let u=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,variant:this.chipset,num_leds:this.numLeds,type:this.rgb_order,method:{type:"esp32_rmt",channel:this.channel},restore_mode:this.restoreMode,default_transition_length:this.defaultTransitionLength},subsystem:this.getSubsystem()}];if(u.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),!h)return m;{let r=[];return this.effects[0]&&(r=r.concat([{pulse:null},{pulse:{name:"Fast Pulse",transition_length:"0.5s",update_interval:"0.5s"}},{pulse:{name:"Slow Pulse",update_interval:"2s"}}])),this.effects[1]&&(r=r.concat([{random:null},{random:{name:"My Slow Random Effect",transition_length:"30s",update_interval:"30s"}},{random:{name:"My Fast Random Effect",transition_length:"4s",update_interval:"5s"}}])),this.effects[2]&&(r=r.concat([{strobe:null},{strobe:{name:"Strobe Effect With Custom Values",colors:[{state:!0,brightness:"100%",red:"100%",green:"0%",blue:"0%",duration:"500ms"},{state:!1,duration:"250ms"},{state:!0,brightness:"100%",red:"0%",green:"100%",blue:"0%",duration:"500ms"}]}}])),this.effects[3]&&(r=r.concat([{flicker:null},{flicker:{name:"Flicker Effect With Custom Values",alpha:"95%",intensity:"1.5%"}}])),this.effects[4]&&(r=r.concat([{addressable_rainbow:null},{addressable_rainbow:{name:"Rainbow Effect With Custom Values",speed:10,width:50}}])),this.effects[5]&&(r=r.concat([{addressable_color_wipe:null},{addressable_color_wipe:{name:"Color Wipe Effect With Custom Values",add_led_interval:"100ms",reverse:!1,colors:[{red:"100%",green:"100%",blue:"100%",num_leds:1},{red:"0%",green:"0%",blue:"0%",num_leds:1}]}}])),this.effects[6]&&(r=r.concat([{addressable_scan:null},{addressable_scan:{name:"Scan Effect With Custom Values",move_interval:"100ms",scan_width:1}}])),this.effects[7]&&(r=r.concat([{addressable_twinkle:null},{addressable_twinkle:{name:"Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"4ms"}}])),this.effects[8]&&(r=r.concat([{addressable_random_twinkle:null},{addressable_random_twinkle:{name:"Random Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"32ms"}}])),this.effects[9]&&(r=r.concat([{addressable_fireworks:null},{addressable_fireworks:{name:"Fireworks Effect With Custom Values",update_interval:"32ms",spark_probability:"10%",use_random_color:!1,fade_out_rate:120}}])),this.effects[10]&&(r=r.concat([{addressable_flicker:null},{addressable_flicker:{name:"Adressable flicker Effect With Custom Values",update_interval:"16ms",intensity:"5%"}}])),u[0].config.effects=r,m}}getSubsystem(){return{name:this.name,type:this.type,actions:[{name:"on",label:"Turn on",description:"Turns on the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:0,b:0},effect:"none",brightness:255}}},{name:"off",label:"Turn off",description:"Turns off the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"OFF",color:{r:0,g:0,b:0},effect:"none",brightness:255}}},{name:"toggle",label:"Pulse Effect",description:"Turn on an effect on the neopixel bus",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:255,b:255},effect:"pulse",brightness:255}}}]}}constructor(r,m,h,u,_,f,g,w,S,E,A,T,I,P,D,R,C,q,L){this.effects=[],this.name=r,this.type="light",this.platform=m,this.rgb_order=u,this.chipset=_,this.numLeds=h,this.restoreMode=f,this.defaultTransitionLength=g,this.channel=w,this.effects=[S,E,A,T,I,P,D,R,C,,q,L],this.mqttMsgs={state:"ON",color:{r:255,g:0,b:0},effect:"My Slow Random Effect",brightness:255}}}function em(r,m,h,u,_,f,g,w,S,E,A,T,I,P,D,R,C){return new ed(r,"neopixelbus",m,h,u,_,f,g,w,S,E,A,T,I,P,D,R,C)}class eh{attach(r){return{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n")}}constructor(r,m){this.name=r,this.platform=m}}function ep(r){return new eh(r,"gpio")}function eu(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return h.forEach(h=>{let{key:u,nestedKey:_}=h;r.config[_]&&(m[u]||(m[u]={}),m[u][_]||(m[u][_]=[]),Array.isArray(m[u][_])?m[u][_].push(...r.config[_]):m[u][_]={...m[u][_],...r.config[_]})}),Array(m)[0]}function e_(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=h.map(r=>r.key);return console.log("lluis keys: ",u),u.includes(r.name)?console.log("deviceComponents lluis: ",m=eu(r,m,h)):m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name].push(r.config)):m[r.name]=r.config,console.log("lluis devComponents: ",m),console.log("lluis devComponents Array: ",Array(m)),Array(m)[0]}class ef{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,restore_mode:this.restoreMode},subsystem:this.getSubsystem()},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/pulsed_on"),then:[{"switch.turn_on":this.name},{delay:"@!lambda return atoi(x.c_str());@"},{"switch.turn_off":this.name}]}]}}];return h.forEach((r,h)=>{m=e_(r,m,[{key:"mqtt",nestedKey:"on_message"}])}),m}getSubsystem(){return{name:this.name,type:this.type,config:{restoreMode:"ON"},actions:[{name:"on",label:"Turn on",description:"turns on the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"ON"}},{name:"off",label:"Turn off",description:"turns off the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"OFF"}},{name:"toggle",label:"Toggle",description:"Toggles the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"TOGGLE"}},{name:"pulsed_on",label:"Pulsed ON ms",description:"Emmits a ON pulse with programable ms of duration",endpoint:"/"+this.type+"/"+this.name+"/pulsed_on",connectionType:"mqtt",payload:{type:"str"}}]}}constructor(r,m,h){this.name=r,this.platform=m,this.restoreMode=h,this.type="switch"}}function eg(r,m){return new ef(r,"gpio",m)}class ey{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,update_interval:this.updateInterval,attenuation:this.attenuation},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"status",label:"Get status",description:"Get sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m,h,u){this.name=r,this.platform=m,this.type="sensor",this.updateInterval=h,this.attenuation=u||"auto"}}function eb(r,m,h){return new ey(r,"adc",m,h)}class ev{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n")}}constructor(r,m){this.name=r,this.platform=m}}function ew(r){return new ev(r,"pulse_counter")}class ex{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_json_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n      - lambda: |-\n          if (x.containsKey("pwmLevel"))  {\n            id(').concat(this.name,').set_level((float)x["pwmLevel"]);\n          }\n')},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      frequency: ").concat(this.frequency,"\n")}]}constructor(r,m,h){this.name=r,this.platform=m,this.frequency=h,this.mqttTopicPrefix=""}}function eS(r,m){return new ex(r,"ledc",m)}class eE{attach(r){return{componentName:"binary_sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      device_class: motion\n")}}constructor(r,m){this.name=r,this.platform=m}}function eA(r){return new eE(r,"gpio")}class eT{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,name:this.name,id:this.name,dout_pin:r,clk_pin:this.clkPin,gain:this.gain,update_interval:this.updateInterval},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"load",label:"Load cell",description:"Get load cell status",units:"pts",endpoint:"/sensor/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,_){this.type="sensor",this.name=r,this.platform=m,this.clkPin=h,this.updateInterval=_,this.gain=u}}function eI(r,m,h,u){return new eT(r,"hx711",m,h,u)}class eP{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      update_interval: ").concat(this.updateInterval,"\n      attenuation: ").concat(this.attenuation,"\n")}}constructor(r,m,h){this.name=r,this.platform=m,this.updateInterval=h,this.attenuation="11db"}}function eD(r,m){return new eP(r,"adc",m)}class eR{attach(r,m){let h=[{name:this.type,config:{id:this.name,i2c_id:this.i2cBusId,update_interval:this.updateInterval,on_tag:{then:[{"mqtt.publish":{topic:"devices/".concat(m.esphome.name,"/sensor/").concat(this.name,"/state"),payload:"@!lambda return x;@"}}]},on_tag_removed:{then:[{"mqtt.publish":{topic:"devices/".concat(m.esphome.name,"/sensor/").concat(this.name,"/state"),payload:'@!lambda return "none";@'}}]}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"nfcreader",labels:"Read tag",description:"Get tag read status",endpoint:"/sensor/".concat(this.name,"/state"),connectionType:"mqtt"}]}}constructor(r,m,h,u){this.type="pn532_i2c",this.name=r,this.platform=m,this.address,this.updateInterval=u,this.i2cBusId=h,this.mqttMsgs=""}}function eC(r,m,h){return new eR(r,"pn532",m,h)}class ek{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      trigger_pin: ").concat(r,"\n      echo_pin: ").concat(this.echoPin,"\n      update_interval: ").concat(this.updateInterval,"\n      timeout : ").concat(this.timeout,"\n")}}constructor(r,m,h,u,_){this.name=r,this.platform=m,this.echoPin=h,this.updateInterval=u,this.timeout=_}}function eq(r,m,h,u){return new ek(r,"ultrasonic",m,h,u)}class eL{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n        - lambda: |-\n            if (x=="ON")  {\n              id(').concat(this.name,").turn_on();\n            }else{\n              id(").concat(this.name,").turn_off();\n            }\n  ")},{componentName:"i2c",payload:"   sda: 21\n   scl: 22\n   scan: true\n   id: bus_a\n\n"},{componentName:this.platform,payload:"    - id: pca9685_hub1\n      frequency: 100\n\n"},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      channel: 11\n      id: ").concat(this.name,"\n      pca9685_id: 'pca9685_hub1'\n\n")}]}constructor(r,m){this.name=r,this.platform=m,this.mqttTopicPrefix=""}}function eM(r){return new eL(r,"pca9685")}class eF{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{name:"on_json_message",config:{topic:"".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command"),then:{lambda:'if (x.containsKey("file2Play")){\n    id('.concat(this.platform,'file) = (int) x["file2Play"];\n    for(int i = 0; i<10 && !id(').concat(this.name,"busypin).state; i++){\n      id(").concat(this.name,').play_file((int) x["file2Play"]);\n    }\n}\nif(x.containsKey("volume")){\n    id(').concat(this.platform,'vol) = (int) x["volume"];\n    id(').concat(this.name,').set_volume((int) x["volume"]);\n}')}}},{name:"globals",config:{id:"".concat(this.platform,"file"),type:"int",restore_value:"no",initial_value:"0"}},{name:"globals",config:{id:"".concat(this.platform,"vol"),type:"int",restore_value:"no",initial_value:"30"}},{name:"uart",config:{id:"".concat(this.platform,"dfplayer"),tx_pin:r,rx_pin:this.rxPin,baud_rate:9600}},{name:this.platform,config:{uart_id:"".concat(this.platform,"dfplayer"),id:this.name,on_finished_playback:{then:{"logger.log":"Somebody press play!"}}},subsystem:{action:[{name:"Set Volume",description:"Sets de mp3 volume",endpoint:"/command",connectionType:"mqtt",payload:{type:"json",json:{volume:{type:"int",min:0,max:30}}}},{name:"Play file",description:"Plays the specified file",endpoint:"/command",connectionType:"mqtt",value:{type:"json",json:{file2Play:{type:"int",min:0,max:void 0}}}}]}},{name:"binary_sensor",config:{platform:"gpio",pin:this.busyPin,name:"".concat(this.name,"busypin"),id:"".concat(this.name,"busypin"),filters:[{invert:null},{delayed_off:"100ms"},{delayed_on:"100ms"}]}}]}constructor(r,m,h,u){this.name=r,this.platform=m,this.rxPin=h,this.busyPin=u,this.mqttTopicPrefix=""}}function eN(r,m,h){return new eF(r,"dfplayer",m,h)}class eO{getWifiPowerMode(){return"light"}attach(r){return[{componentName:"esp32_ble_tracker",payload:"   scan_parameters:\n        interval: 320ms # try with 300ms if you don't have LAN module\n        window: 30ms # try with 300ms if you don't have LAN module\n        continuous: true\n        active: false\n"},{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      mac_address: '").concat(this.macAddress,"'\n      id: ").concat(this.id,'\n      temperature:\n          name: "').concat(this.id,'temperature"\n   \n      moisture:\n          name: "').concat(this.id,'moisture"\n\n      illuminance:\n          name: "').concat(this.id,'illuminance"\n\n      conductivity:\n          name: "').concat(this.id,'soilconductivity"\n\n      battery_level:\n          name: "').concat(this.id,'batterylevel"\n')}]}constructor(r,m,h){this.id=r,this.platform=m,this.macAddress=h}}function ej(r,m){return new eO(r,"xiaomi_hhccjcy01",m)}class eG{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"remote_transmitter",payload:"   pin: ".concat(r,"\n   carrier_duty_percent: 50%\n\n")},{componentName:"climate",payload:"  - platform: ".concat(this.platform,'\n    name: "').concat(this.name,'"\n    id: ').concat(this.name,"\n    protocol: ").concat(this.protocol,"\n    horizontal_default: ").concat(this.horizontal_default,"\n    vertical_default: ").concat(this.verical_default,"\n    max_temperature: ").concat(this.max_temperature,"\n    min_temperature: ").concat(this.min_temperature,"\n\n")}]}constructor(r,m,h,u,_,f,g){this.name=r,this.platform=m,this.protocol=h,this.horizontal_default=u,this.verical_default=_,this.max_temperature=f,this.min_temperature=g,this.mqttTopicPrefix=""}}function ez(r,m,h,u,_,f){return new eG(r,"heatpumpir",m,h,u,_,f)}class eU{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command\n      then:\n      - lambda: |-\n         float value = atoi(x.c_str());\n         if(value >= 0 && value <= 180) id(").concat(this.name,").write(value/180);\n         if(value > 180) id(").concat(this.name,").write(180);\n         if(value < 0) id(").concat(this.name,").write(0);\n")},{componentName:"output",payload:"  - platform: ledc\n    pin: ".concat(r,"\n    id: ").concat(this.name,"ledcOutput\n    frequency: 50 Hz\n")},{componentName:"servo",payload:"  - id: ".concat(this.name,"\n    output: ").concat(this.name,"ledcOutput\n    auto_detach_time: 0s\n    transition_length: 0s\n")}]}constructor(r,m){this.name=r,this.platform=m,this.mqttTopicPrefix=""}}function eB(r){return new eU(r,"servo")}class eH{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"".concat(this.platform),payload:"    id: ".concat(this.name,"\n    address: 0x5A\n    touch_debounce: 1\n    release_debounce: 1\n    touch_threshold: 10\n    release_threshold: 7\n")},...this.channels.map((r,m)=>r?{componentName:"binary_sensor",payload:"    - platform: mpr121\n      id: ".concat(this.name+"_"+m,"\n      channel: ").concat(m,"\n      name:  ").concat(this.name+"_"+m,"\n      touch_threshold: 12\n      release_threshold: 6\n")}:null).filter(Boolean)]}constructor(r,m,h,u,_,f,g,w,S,E,A,T,I,P,D,R){this.channels=[],this.name=r,this.platform=m,this.i2cBusId=h,this.sclPin=u,this.mqttTopicPrefix="",this.channels=[_,f,g,w,S,E,A,T,I,P,D,R]}}function eW(r,m,h,u,_,f,g,w,S,E,A,T,I,P){return new eH(r,"mpr121","bus_a",m,h,u,_,f,g,w,S,E,A,T,I,P)}class eV{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,model:this.model,id:this.name,update_interval:this.updateInterval,temperature:{name:this.name+"-temperature"},humidity:{name:this.name+"-humidity"}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"temperature",label:"Temperature",description:"Get sensor status",endpoint:"/"+this.type+"/"+this.name+"-temperature/state",connectionType:"mqtt"},{name:"humidity",label:"Humidity",description:"Get sensor status",endpoint:"/"+this.type+"/"+this.name+"-humidity/state",connectionType:"mqtt"}]}}constructor(r,m,h,u){this.name=r,this.platform=m,this.type="sensor",this.model=h,this.updateInterval=u}}function eZ(r,m,h){return new eV(r,"dht",m,h)}class e${setMqttTopicPrefix(r){this.mqttTopicPrefix=r}setDeepSleep(r){this.dpEnabled=r}attach(r){var m=[{name:"uart",config:{id:"".concat(this.name,"uartmodbus"),tx_pin:r,rx_pin:this.rxPin,baud_rate:19200,stop_bits:2}},{name:this.platform,config:{id:"".concat(this.name,"modbusid"),uart_id:"".concat(this.name,"uartmodbus")}},{name:"modbus_controller",config:{id:"".concat(this.name,"modbuscontrollerid"),address:1,modbus_id:"".concat(this.name,"modbusid"),setup_priority:-10,update_interval:this.updateInterval}},{name:"sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"load"),name:"".concat(this.name,"load"),unit_of_measurement:"Kg",address:parseInt(this.weightRegister),register_type:"holding",value_type:2==this.weightRegisters2Read?"U_DWORD":"U_WORD",register_count:parseInt(this.weightRegisters2Read)}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags0"),name:"".concat(this.name,"stateflags0"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:0}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags3"),name:"".concat(this.name,"stateflags3"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:3}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags4"),name:"".concat(this.name,"stateflags4"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:16}}];let h=[{name:"switch",config:{platform:"gpio",pin:this.enablePin,id:"".concat(this.name,"enablepin"),name:"".concat(this.name,"enablepin")}},{name:"on_boot",config:{priority:100,then:[{"switch.turn_on":"".concat(this.name,"enablepin")},{wait_until:{condition:{"mqtt.connected":null}}},{"component.update":"".concat(this.name,"modbuscontrollerid")},{delay:"1s"},{"deep_sleep.enter":"ds"}]}},{name:"on_shutdown",config:{priority:700,then:[{"switch.turn_off":"".concat(this.name,"enablepin")}]}}];return this.dpEnabled&&(m=m.concat(h)),m}constructor(r,m,h,u,_,f,g,w){this.name=r,this.platform=m,this.rxPin=h,this.enablePin=u,this.updateInterval=_,this.weightRegister=f,this.weightRegisters2Read=g,this.stateFlagsRegister=w,this.mqttTopicPrefix="",this.dpEnabled=!1}}function eK(r,m,h,u,_,f,g){return new e$(r,"modbus",m,h,u,_,f,g)}class eY{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n")}]}constructor(r,m,h,u,_,f){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=_,this.sclPin=f,this.mqttTopicPrefix=""}}function eX(r,m,h,u){return new eY(r,"bh1750",h,u,"bus_a",m)}class eJ{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-aqi"\n        calculation_type: "CAQI"\n')}]}constructor(r,m,h,u,_,f){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=_,this.sclPin=f,this.mqttTopicPrefix=""}}function eQ(r,m,h,u){return new eJ(r,"hm3301",h,u,"bus_a",m)}class e0{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-ethanol\n      methane:\n        name: ").concat(this.name,"-methane\n      ammonia:\n        name: ").concat(this.name,"-ammonia\n")}]}constructor(r,m,h,u,_,f){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=_,this.sclPin=f,this.mqttTopicPrefix=""}}function e1(r,m,h,u){return new e0(r,"mics_4514",h,u,"bus_a",m)}class e2{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,address:this.address,update_interval:this.updateInterval,accel_x:{name:"".concat(this.name,"-accel-x")},accel_y:{name:"".concat(this.name,"-accel-y")},accel_z:{name:"".concat(this.name,"-accel-z")},gyro_x:{name:"".concat(this.name,"-gyro-x")},gyro_y:{name:"".concat(this.name,"-gyro-y")},gyro_z:{name:"".concat(this.name,"-gyro-z")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"accel_x",label:"Accelerometer X",description:"Get accelerometer X axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-x/state",connectionType:"mqtt"},{name:"accel_y",label:"Accelerometer Y",description:"Get accelerometer Y axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-y/state",connectionType:"mqtt"},{name:"accel_z",label:"Accelerometer Z",description:"Get accelerometer Z axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-z/state",connectionType:"mqtt"},{name:"gyro_x",label:"Gyroscope X",description:"Get gyroscope X axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-x/state",connectionType:"mqtt"},{name:"gyro_y",label:"Gyroscope Y",description:"Get gyroscope Y axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-y/state",connectionType:"mqtt"},{name:"gyro_z",label:"Gyroscope Z",description:"Get gyroscope Z axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-z/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,_){this.type="sensor",this.name=r,this.platform=m,this.address=u,this.updateInterval=_,this.i2cBusId=h}}function e5(r,m,h,u){return new e2(r,"mpu6050",m,h,u)}class e3{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: bh1750\n      id: ".concat(this.name,"bh1750\n      name: ").concat(this.name,"bh1750\n      address: ").concat(this.bh1750Address,"\n      update_interval: ").concat(this.updateInterval,"\n")},{componentName:"sensor",payload:"    - platform: hm3301 \n      id: ".concat(this.name,"hm3301\n      address: ").concat(this.hm3301Address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-hm3301-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-hm3301-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-hm3301-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-hm3301-aqi"\n        calculation_type: "CAQI"\n')},{componentName:"sensor",payload:"    - platform: mics_4514 \n      id: ".concat(this.name,"sen0377\n      address: ").concat(this.sen0377Address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-sen0377-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-sen0377-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-sen0377-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-sen0377-ethanol\n      methane:\n        name: ").concat(this.name,"-sen0377-methane\n      ammonia:\n        name: ").concat(this.name,"-sen0377-ammonia\n")},,{componentName:"sensor",payload:"    - platform: mpu6050\n      id: ".concat(this.name,"mpu6050\n      address: ").concat(this.mpu6050Address,"\n      update_interval: ").concat(this.updateInterval,'\n      accel_x:\n        name: "').concat(this.name,'-mpu6050-accel-x"\n      accel_y:\n        name: "').concat(this.name,'-mpu6050-accel-y"\n      accel_z:\n        name: "').concat(this.name,'-mpu6050-accel-z"\n      gyro_x:\n        name: "').concat(this.name,'-mpu6050-gyro-x"\n      gyro_y:\n        name: "').concat(this.name,'-mpu6050-gyro-y"\n      gyro_z:\n        name: "').concat(this.name,'-mpu6050-gyro-z"\n      temperature:\n        name: "').concat(this.name,'-mpu6050-temperature"\n')}]}constructor(r,m,h,u,_,f,g,w){this.name=r,this.sclPin=m,this.updateInterval=h,this.i2cBusId=u,this.mqttTopicPrefix="",this.bh1750Address=_,this.hm3301Address=f,this.sen0377Address=g,this.mpu6050Address=w}}function e6(r,m,h,u,_,f,g){return new e3(r,m,h,"bus_a",u,_,f,g)}class e4{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,address:this.address,update_interval:this.updateInterval,pm_1_0:{name:"".concat(this.name,"-pm1-0")},pm_2_5:{name:"".concat(this.name,"-pm2-5")},pm_4_0:{name:"".concat(this.name,"-pm4-0")},pm_10_0:{name:"".concat(this.name,"-pm10-0")},temperature:{name:"".concat(this.name,"-temperature")},humidity:{name:"".concat(this.name,"-humidity")},nox:{name:"".concat(this.name,"-nox")},voc:{name:"".concat(this.name,"-voc")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"pm1.0",label:"Pm1.0",description:"Get pm1.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm1-0/state",connectionType:"mqtt"},{name:"pm2.5",label:"Pm2.5",description:"Get pm2.5 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm2-5/state",connectionType:"mqtt"},{name:"pm4.0",label:"Pm4.0",description:"Get pm4.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm4-0/state",connectionType:"mqtt"},{name:"pm10.0",label:"Pm10.0",description:"Get pm10.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm10-0/state",connectionType:"mqtt"},{name:"temperature",label:"Temperature",description:"Get temperature status",units:"\xbaC",endpoint:"/sensor/"+this.name+"-temperature/state",connectionType:"mqtt"},{name:"humidity",label:"Humidity",description:"Get humidity status",units:"%",endpoint:"/sensor/"+this.name+"-humidity/state",connectionType:"mqtt"},{name:"nox",label:"NOx",description:"Get NOX status",endpoint:"/sensor/"+this.name+"-nox/state",connectionType:"mqtt"},{name:"voc",label:"VOC",description:"Get VOC status",endpoint:"/sensor/"+this.name+"-voc/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,_){this.type="sensor",this.name=r,this.platform=m,this.address=u,this.updateInterval=_,this.i2cBusId=h}}function e8(r,m,h,u){return new e4(r,"sen5x",m,h,u)}class e9{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,uart_id:this.uartBusId,update_interval:this.updateInterval,co2:{name:"".concat(this.name,"-co2")},temperature:{name:"".concat(this.name,"-temperature")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"CO_2",description:"Get CO_2 status",units:"ppm",endpoint:"/"+this.type+"/"+this.name+"-co2/state",connectionType:"mqtt"},{name:"CO_2-temp",description:"Get CO_2 status",units:"\xbaC",endpoint:"/"+this.type+"/"+this.name+"-temperature/state",connectionType:"mqtt"}]}}constructor(r,m,h,u){this.type="sensor",this.name=r,this.platform=m,this.uartBusId=h,this.updateInterval=u,this.mqttTopicPrefix=""}}function e7(r,m,h){return new e9(r,"mhz19",m,h)}class nt{attach(r,m){let h=[{name:this.type,config:{id:this.id,sda:r,scl:this.scl,scan:this.scan},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h){this.type="i2c",this.scl=m,this.scan=h,this.id=r}}function ne(r,m,h){return new nt(r,m,h)}class nn{getOutputComponents(){let r=[];for(var m=0;m<16;m++){let h={name:"output",config:{platform:"pca9685",pca9685_id:this.name,channel:m,id:this.name+"_channel_"+m},subsystem:{}};r.push(h)}return r}attach(r,m){let h=[{name:this.type,config:{id:this.name,...this.external_clock_input?{}:{frequency:this.frequency},external_clock_input:this.external_clock_input,address:this.address,i2c_id:this.i2cBusId},subsystem:this.getSubsystem()}],u=this.getOutputComponents();return(h=h.concat(u)).forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h,u,_){this.type="pca9685",this.name=r,this.frequency=m,this.external_clock_input=h,this.address=u,this.i2cBusId=_}}function ni(r,m,h,u,_){return new nn(r,m,h,u,_)}class na{attach(r,m){return[{name:"ethernet",config:{type:this.type,mdc_pin:this.mdc_pin,mdio_pin:this.mdio_pin,clk_mode:this.clk_mode,phy_addr:this.phy_addr,power_pin:this.power_pin},subsystem:this.getSubsystem()}].forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h,u,_,f){this.type=r,this.mdc_pin=m,this.mdio_pin=h,this.clk_mode=u,this.phy_addr=_,this.power_pin=f}}function ns(r,m,h,u,_,f){return new na(r,m,h,u,_,f)}class no{attach(r,m){let h=[{name:"external_components",config:[{source:{type:"git",url:"https://github.com/u-fire/ESPHomeComponents/"}}]},{name:"i2c",config:{sda:r,scl:this.scl},subsystem:this.getSubsystem()},{name:this.type,config:{platform:"mod_ntc",id:"water_temp",name:"water-temp",on_value:{then:[{"component.update":"ec"},{"component.update":"ph"}]}},subsystem:this.getSubsystem()},{name:this.type,config:{platform:"mod_ec",id:"ec",update_interval:this.updateInterval,name:"EC",temperature_sensor:"water_temp"},subsystem:this.getSubsystem()},{name:this.type,config:{platform:"mod_ph",id:"ph",update_interval:this.updateInterval,name:"pH",temperature_sensor:"water_temp"},subsystem:this.getSubsystem()},{name:"button",config:{platform:"template",id:"ec_calibrate_low",name:"EC Calibrate Low 0.5",on_press:{lambda:"return id(ec).calibrateLow(0.5);"}}},{name:"button",config:{platform:"template",id:"ec_calibrate_high",name:"EC Calibrate High 5.0",on_press:{lambda:"return id(ec).calibrateHigh(5.0);"}}},{name:"button",config:{platform:"template",id:"ec_calibrate_reset",name:"EC Calibrate Reset",on_press:{lambda:"return id(ec).calibrateReset();"}}},{name:"button",config:{platform:"template",id:"ph_calibrate_low",name:"pH Calibrate Low 4.0",on_press:{lambda:"return id(ph).calibrateLow(4.0);"}}},{name:"button",config:{platform:"template",id:"ph_calibrate_mid",name:"pH Calibrate Mid 7.0",on_press:{lambda:"return id(ph).calibrateMid(7.0);"}}},{name:"button",config:{platform:"template",id:"ph_calibrate_high",name:"pH Calibrate High 10.0",on_press:{lambda:"return id(ph).calibrateHigh(10.0);"}}},{name:"button",config:{platform:"template",id:"ph_calibrate_reset",name:"pH Calibrate Reset",on_press:{lambda:"return id(ph).calibrateReset();"}}},{name:"button",config:{platform:"factory_reset",name:"Restart with Factory Default Settings"}}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Ph",label:"ph",description:"Get sensor status",endpoint:"/"+this.type+"/ph/state",connectionType:"mqtt"},{name:"Water Temperature",label:"water-temp",description:"Get sensor status",endpoint:"/"+this.type+"/water-temp/state",connectionType:"mqtt"},{name:"EC",label:"ec",description:"Get sensor status",endpoint:"/"+this.type+"/ec/state",connectionType:"mqtt"}]}}constructor(r,m,h){this.name=r,this.platform="mod_ntc",this.scl=h,this.type="sensor",this.updateInterval=m}}function nr(r,m,h){return new no(r,h,m)}class nc{attach(r,m){let h=[{name:this.type,config:{id:this.id,tx_pin:r,rx_pin:this.rx,baud_rate:this.baudrate},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h){this.type="uart",this.rx=m,this.baudrate=h,this.id=r}}function nl(r,m,h){return new nc(r,m,h)}class nd{extractNestedComponents(r,m){let h=[{key:"mqtt",nestedKey:"on_message"},{key:"esphome",nestedKey:"on_boot"}];h.forEach(h=>{let{key:u,nestedKey:_}=h;r.config[_]&&(m[u]||(m[u]={}),m[u][_]||(m[u][_]=[]),Array.isArray(m[u][_])?m[u][_].push(...r.config[_]):m[u][_]={...m[u][_],...r.config[_]})})}extractComponent(r,m){["mqtt","esphome"].includes(r.name)?this.extractNestedComponents(r,m):m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name].push(r.config)):m[r.name]=r.config}attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,step_pin:r,dir_pin:this.dirPin,max_speed:this.maxSpeed,acceleration:this.acceleration,deceleration:this.deceleration},subsystem:this.getSubsystem()},{name:"switch",config:{platform:"gpio",pin:this.sleepPin,name:this.name+"_sleep_switch",id:this.name+"_sleep_switch",restore_mode:"ALWAYS_ON"}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/set_target"),then:{lambda:"id(".concat(this.name,"_sleep_switch).turn_off();\nint value = atoi(x.c_str());\nid(").concat(this.name,').set_target(value);\nESP_LOGD("Set target", "').concat(this.name,' stepper target set to: %d",  value);\n')}}]}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/set_max_speed"),then:{lambda:"int value = atoi(x.c_str());\nif (value > 0){\n  id(".concat(this.name,').set_max_speed(value);\n  ESP_LOGD("Set max speed", "').concat(this.name,' stepper max speed set to: %d",  value);\n} else {\n  ESP_LOGD("Set max speed", "').concat(this.name,' invalid max speed value");\n}')}}]}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/set_acceleration"),then:{lambda:"int value = atoi(x.c_str());\nif (value > 0){\n  id(".concat(this.name,').set_acceleration(value);\n  ESP_LOGD("Set acceleration", "').concat(this.name,' stepper acceleration set to: %d",  value);\n} else {\n  ESP_LOGD("Set acceleration", "').concat(this.name,' invalid acceleration value");\n}')}}]}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/set_deceleration"),then:{lambda:"int value = atoi(x.c_str());\nif (value > 0){\n  id(".concat(this.name,').set_acceleration(value);\n  ESP_LOGD("Set deceleration", "').concat(this.name,' stepper deceleration set to: %d",  value);\n} else {\n  ESP_LOGD("Set deceleration", "').concat(this.name,' invalid deceleration value");\n}\n')}}]}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/report_position"),then:{lambda:"int value = atoi(x.c_str());\nid(".concat(this.name,").report_position(value);\nid(").concat(this.name,').set_target(value);\nESP_LOGD("Report position", "').concat(this.name,' stepper report position set to: %d",  value);\n')}}]}},{name:"mqtt",config:{on_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/move_steps"),then:{lambda:"int value = atoi(x.c_str());\nid(".concat(this.name,").report_position(0);\nid(").concat(this.name,').set_target(value);\nESP_LOGD("Report position", "').concat(this.name,' stepper move X steps set to: %d",  value);\n')}}]}},{name:"binary_sensor",config:{platform:"template",name:"".concat(this.name,"_has_reached_target"),id:"".concat(this.name,"_has_reached_target"),lambda:"return id(".concat(this.name,").has_reached_target();\n")}}];return h.forEach((r,h)=>{this.extractComponent(r,m)}),m}getSubsystem(){return{name:this.name,type:this.type,actions:[{name:"set_target",label:"Set target",description:"Sets target of the stepper",endpoint:"/"+this.type+"/"+this.name+"/set_target",connectionType:"mqtt",payload:{type:"str"}},{name:"set_max_speed",label:"Set max speed",description:"Sets speed of the stepper",endpoint:"/"+this.type+"/"+this.name+"/set_max_speed",connectionType:"mqtt",payload:{type:"str"}},{name:"set_acceleration",label:"Set acceleration",description:"Sets acceleration of the stepper",endpoint:"/"+this.type+"/"+this.name+"/set_acceleration",connectionType:"mqtt",payload:{type:"str"}},{name:"set_deceleration",label:"Set deceleration",description:"Sets deceleration of the stepper",endpoint:"/"+this.type+"/"+this.name+"/set_deceleration",connectionType:"mqtt",payload:{type:"str"}},{name:"report_position",label:"Report position",description:"Reports position of the stepper",endpoint:"/"+this.type+"/"+this.name+"/report_position",connectionType:"mqtt",payload:{type:"str"}},{name:"move_steps",label:"Move X steps",description:"Move stepper X steps",endpoint:"/"+this.type+"/"+this.name+"/move_steps",connectionType:"mqtt",payload:{type:"str"}},{name:"hold_motor",label:"Hold motor",description:"Holds the motor power, so it doesn't move",endpoint:"/switch/"+this.name+"_sleep_switch/command",connectionType:"mqtt",payload:{type:"str",value:"OFF"}},{name:"release_motor",label:"Release motor",description:"Releases the motor power, so it can move",endpoint:"/switch/"+this.name+"_sleep_switch/command",connectionType:"mqtt",payload:{type:"str",value:"ON"}}],monitors:[{name:"has_reached_target",label:"Has reached target",description:"Has reached target",endpoint:"/binary_sensor/"+"".concat(this.name,"_has_reached_target")+"/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,_,f,g){this.type="stepper",this.name=r,this.platform=m,this.dirPin=h,this.maxSpeed=u,this.sleepPin=_,this.acceleration=f,this.deceleration=g}}function nm(r,m,h,u,_,f){return new nd(r,"a4988",m,h,u,_,f)}class nh{extractNestedComponents(r,m){let h=[{key:"mqtt",nestedKey:"on_json_message"}];h.forEach(h=>{let{key:u,nestedKey:_}=h;r.config[_]&&(m[u]||(m[u]={}),m[u][_]||(m[u][_]=[]),Array.isArray(m[u][_])?m[u][_].push(...r.config[_]):m[u][_]={...m[u][_],...r.config[_]})})}extractComponent(r,m){["mqtt"].includes(r.name)?this.extractNestedComponents(r,m):m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name].push(r.config)):m[r.name]=r.config}attach(r,m){let h=[{name:this.platform,config:{uart_id:this.uartBusId,id:this.name,sensing_pin:{number:r,allow_other_uses:!0},on_finger_scan_start:[{"fingerprint_grow.aura_led_control":{state:"ALWAYS_ON",color:"GREEN",speed:0,count:0}}],on_finger_scan_matched:[{"fingerprint_grow.aura_led_control":{state:"FLASHING",speed:200,color:"BLUE",count:1}},{"text_sensor.template.publish":{id:"".concat(this.name,"_fingerprint_state"),state:'@!lambda return "Authorized finger " + to_string(finger_id) + ", confidence " + to_string(confidence);@'}}],on_finger_scan_unmatched:[{"fingerprint_grow.aura_led_control":{state:"FLASHING",speed:25,color:"RED",count:2}},{"text_sensor.template.publish":{id:"".concat(this.name,"_fingerprint_state"),state:"Unmatched finger"}}],on_finger_scan_misplaced:[{"fingerprint_grow.aura_led_control":{state:"FLASHING",speed:25,color:"PURPLE",count:2}},{"text_sensor.template.publish":{id:"".concat(this.name,"_fingerprint_state"),state:"Finger misplaced"}}],on_enrollment_scan:[{"fingerprint_grow.aura_led_control":{state:"FLASHING",speed:25,color:"BLUE",count:2}},{"fingerprint_grow.aura_led_control":{state:"ALWAYS_ON",speed:0,color:"PURPLE",count:0}}],on_enrollment_done:[{"fingerprint_grow.aura_led_control":{state:"BREATHING",speed:100,color:"BLUE",count:2}}],on_enrollment_failed:[{"fingerprint_grow.aura_led_control":{state:"FLASHING",speed:25,color:"RED",count:4}}]},subsystem:this.getSubsystem()},{name:"binary_sensor",config:{platform:"gpio",pin:{number:r,allow_other_uses:!0,inverted:!0},name:"".concat(this.name,"-finger-present")}},{name:"sensor",config:{platform:"fingerprint_grow",fingerprint_count:{name:"".concat(this.name,"-fingerprint-count")},last_finger_id:{name:"".concat(this.name,"-last-finger-id")},last_confidence:{name:"".concat(this.name,"-last-confidence")},status:{name:"".concat(this.name,"-status")},capacity:{name:"".concat(this.name,"-capacity")},security_level:{name:"".concat(this.name,"-security-level")}}},{name:"mqtt",config:{on_json_message:[{topic:"devices/".concat(m.esphome.name,"/").concat(this.type,"/").concat(this.name,"/command"),then:{lambda:'if (x.containsKey("action")) {\n  if (x["action"] == "enroll") {\n    id('.concat(this.name,').enroll_fingerprint((int)x["finger_id"], (int)x["num_buffers"]);\n  }\n  if (x["action"] == "finish_enroll") {\n    id(').concat(this.name,').finish_enrollment(OK);\n  }\n  if (x["action"] == "delete_fingerprint") {\n    id(').concat(this.name,').delete_fingerprint((int)x["finger_id"]);\n  }\n  if (x["action"] == "delete_all_fingerprints") {\n    id(').concat(this.name,").delete_all_fingerprints();\n  }\n}")}}]}},{name:"text_sensor",config:{platform:"template",name:"".concat(this.name,"-fingerprint-state"),id:"".concat(this.name,"_fingerprint_state")}}];return h.forEach((r,h)=>{this.extractComponent(r,m)}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"fingerprint-state",description:"Get fingerprint state",endpoint:"/"+this.type+"/"+this.name+"-fingerprint-state/state",connectionType:"mqtt"},{name:"fingerprint-count",description:"Get fingerprint count",endpoint:"/"+this.type+"/"+this.name+"-fingerprint-count/state",connectionType:"mqtt"},{name:"last-finger-id",description:"Get last finger id",endpoint:"/"+this.type+"/"+this.name+"-last-finger-id/state",connectionType:"mqtt"},{name:"last-confidence",description:"Get last confidence",endpoint:"/"+this.type+"/"+this.name+"-last-confidence/state",connectionType:"mqtt"},{name:"status",description:"Get status",endpoint:"/"+this.type+"/"+this.name+"-status/state",connectionType:"mqtt"},{name:"capacity",description:"Get capacity",endpoint:"/"+this.type+"/"+this.name+"-capacity/state",connectionType:"mqtt"},{name:"security-level",description:"Get security level",endpoint:"/"+this.type+"/"+this.name+"-security-level/state",connectionType:"mqtt"},{name:"finger-present",description:"Detects if finger present",endpoint:"/binary_sensor/"+this.name+"-finger-present/state",connectionType:"mqtt"}],actions:[{name:"enroll_0",label:"Enroll id 0",description:"Enroll a fingerprint in id 0",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{action:"enroll",finger_id:0,num_buffers:2}}},{name:"finish_enroll",label:"Finish enroll",description:"Finish enrollment",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{action:"finish_enroll"}}},{name:"delete_fingerprint-0",label:"Delete fingerprint in id 0",description:"Delete a fingerprint",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{action:"delete_fingerprint",finger_id:0}}},{name:"delete_all_fingerprints",label:"Delete all fingerprints",description:"Delete all fingerprints",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{action:"delete_all_fingerprints"}}}]}}constructor(r,m,h){this.type="sensor",this.name=r,this.platform=m,this.uartBusId=h,this.mqttTopicPrefix=""}}function np(r,m){return new nh(r,"fingerprint_grow",m)}class nu{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,i2c_id:this.i2cBusId,update_interval:this.updateInterval,co2:{name:this.name+"-co2"},temperature:{name:this.name+"-temperature"},humidity:{name:this.name+"-humidity"}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"co2",label:"CO2",units:"ppm",description:"Get co2 value in ppm",endpoint:"/sensor/".concat(this.name,"-co2/state"),connectionType:"mqtt"},{name:"temperature",label:"Temperature",units:"\xbaC",description:"Get temperature in \xbaC",endpoint:"/sensor/".concat(this.name,"-temperature/state"),connectionType:"mqtt"},{name:"humidity",label:"Humidity",units:"%",description:"Get humidity in %",endpoint:"/sensor/".concat(this.name,"-humidity/state"),connectionType:"mqtt"}]}}constructor(r,m,h,u){this.type="sensor",this.name=r,this.platform=m,this.address,this.updateInterval=u,this.i2cBusId=h,this.mqttMsgs=""}}function n_(r,m,h){return new nu(r,"scd4x",m,h)}class nf{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,name:this.name,id:this.name,address:this.address},subsystem:this.getSubsystem()},{name:this.platform,config:{pin:r}}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"status",label:"Get temperature",description:"Get temperature status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m,h){this.name=r,this.platform=m,this.type="sensor",this.address=h}}function ng(r,m){return new nf(r,"dallas",m)}var ny=h(60545),nb=h(84291),nv=h(16247),nw=h(36907);let nx=(r,m,h)=>{let[u,_]=(0,H.useState)(),[f,g]=(0,H.useState)(!1),[w,S]=(0,H.useState)(),E=(0,H.useRef)(!1),A=r=>{r.isError?(g(!1),S(r.error)):r.isLoaded&&(g(!1),_(r.data))};return E.current||(g(!0),E.current=!0,m?L.bl.post(r,m,A,h):L.bl.get(r,A,h)),[u,f,w]};var nS=h(65919);let nE=r=>{let{deviceName:m,monitorData:h,subsystem:u}=r,_=new tR.zm(m,u.name,h),[f,g]=(0,H.useState)(void 0),{message:S}=(0,t4.mU)(_.getEndpoint()),[E,A,T]=nx(_.getValueAPIURL()),[I,P]=(0,H.useState)(1);return H.useEffect(()=>{var r;g(null==S?void 0:null===(r=S.message)||void 0===r?void 0:r.toString()),P(1.15),setTimeout(()=>{P(1)},200)},[S]),(0,w.jsxs)(tL.sL,{gap:"$3",children:[(0,w.jsxs)(tC.Text,{flex:1,marginLeft:4,textAlign:"left",children:[_.getLabel(),": "]}),A||void 0===f&&(null==E?void 0:E.value)===void 0?(0,w.jsx)(ny.$,{color:"$color7"}):(0,w.jsx)(O.A,{color:void 0===f?"gray":"$color5",text:"".concat(null!=f?f:null==E?void 0:E.value," ").concat(_.getUnits()),scale:I,animation:"bouncy"})]})},nA=r=>{var m,h;let{deviceName:u,action:_,buttonAction:f}=r,[g,S]=(0,H.useState)("");return _.payload.value?(0,w.jsx)(tc.zx,{onPress:()=>{f(_)},color:"$color10",title:"Description: "+_.description,flex:1,children:null!==(m=_.label)&&void 0!==m?m:_.name},_.name):(0,w.jsxs)(tL.sL,{gap:"$3",children:[(0,w.jsx)(nb.II,{value:g,onChange:async r=>S(r.target.value),width:80,placeholder:"value",mr:8,flex:1}),(0,w.jsx)(tc.zx,{onPress:()=>{f(_,g)},color:"$color10",title:"Description: "+_.description,flex:1,children:null!==(h=_.label)&&void 0!==h?h:_.name},_.name)]})},nT=r=>{var m,h;let{subsystem:u,deviceName:_}=r,{client:f}=(0,t4.Td)(),g=!1,S=(r,m)=>{let h=void 0!=m?m:r.payload.value;"mqtt"==r.connectionType&&(console.log("MQTT Dev: ",r.payload),f.publish((0,tR.Hj)(_,r.endpoint),"json"==r.payload.type?JSON.stringify(h):h.toString()))},E=null===(m=u.actions)||void 0===m?void 0:m.map((r,m)=>(0,w.jsx)(nA,{deviceName:_,action:r,buttonAction:S},m)),A=null===(h=u.monitors)||void 0===h?void 0:h.map((r,m)=>(0,w.jsx)(nE,{deviceName:_,monitorData:r,subsystem:u},m));return(0,w.jsx)(nS._k,{position:"relative",borderRadius:"10px",mt:"10px",children:(0,w.jsxs)(tM.I,{children:[(0,w.jsxs)(tL.sL,{alignItems:"center",justifyContent:"space-between",children:[(0,w.jsx)(nv.Paragraph,{textAlign:"left",color:"$color10",children:u.name}),g?(0,w.jsx)(nw.rs,{id:"pa",size:"$2",defaultChecked:u.generateEvent,children:(0,w.jsx)(nw.rs.Thumb,{animation:"quick"})}):null]}),(0,w.jsxs)(tL.FA,{mb:"10px",mt:"10px",alignSelf:"flex-start",children:[(null==E?void 0:E.length)>0?(0,w.jsx)(tL.sL,{gap:"$2",flexWrap:"wrap",mt:"10px",mb:"10px",children:E}):null,(null==A?void 0:A.length)>0?(0,w.jsx)(tL.sL,{gap:"$3",flexWrap:"wrap",mt:"10px",mb:"10px",children:A}):null]})]})})};var nI=nT,nP=h(75296),nD=h(89560),nR=h(7244),nC=h(82695);let nk="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-20px _mr-0px _mb-0px _ml-20px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",nq="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ",nL="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _mih-0px _miw-0px _fs-0 _r-20px _t-20px _pos-absolute ",nM="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",nF="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-1481558152 _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",nN="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _h-10037 ",nO=r=>{let{onSetStage:m,onSetModalFeedback:h,compileSessionId:u,stage:_}=r,{message:f}=(0,t4.mU)([t6(u)]),[g,S]=(0,H.useState)([]);var E=!1;return(0,H.useEffect)(()=>{if("compile"==_){console.log("Compile Message: ",f);try{if(null==f?void 0:f.message){let r=JSON.parse(null==f?void 0:f.message.toString());"undefined"!=r.position&&(console.log("DEV: ",r),r.position&&!E?h({message:"Current position in queue: ".concat(r.position,". Status: ").concat(r.status),details:{error:!1}}):(h({message:"Compiling...",details:{error:!1}}),E=!0)),"exit"==r.event&&0==r.code?(E=!0,S([]),console.log("Succesfully compiled"),m("upload")):"exit"==r.event&&0!=r.code&&(E=!0,console.error("Error compiling",g),h({message:(0,w.jsxs)("div",{className:nN,children:[(0,w.jsx)("p",{className:nF,children:"Error compiling code."}),(0,w.jsx)("p",{className:nM,children:"Please check your flow configuration."}),(0,w.jsx)(nP.K,{textAlign:"left",f:1,mt:"$2",mb:"$5",minHeight:"200px",value:g.map(r=>r.message).join("")})]}),details:{error:!0}})),S([...g,r])}}catch(r){console.log(r)}}},[f]),(0,w.jsx)(w.Fragment,{})},nj={name:A.V,deviceDefinition:tn.p},nG=async(r,m,h,u)=>{var _={method:m,headers:{"Content-Type":"application/json"}};h&&(_.body=JSON.stringify(h));let f="?";-1!=r.indexOf("?")&&(f="&");var g=r+(u?f+"token="+u:"");return console.log("Deff URL: ",g),fetch(g,_).then(function(r){return r}).catch(r=>{console.log("Error fetching url: ",r)})},nz="/adminapi/v1/devices",nU="/adminapi/v1/deviceDefinitions?all=1";var nB={component:r=>{var m;let{pageState:h,initialItems:u,itemData:_,pageSession:f,extraData:S}=r,{replace:E}=(0,nC.N)(h);Object.keys(g).forEach(r=>window[r]=g[r]);let[A,T]=(0,H.useState)(!1),[P,D]=(0,H.useState)(),[R,O]=(0,H.useState)(""),G=H.useRef(),[z,U]=(0,H.useState)(""),[B,W]=(0,H.useState)(""),V=async(r,m)=>{U(r.data.name),G.current=null!=m?m:await r.getYaml(),console.log("TURBO YAML PARAMETER: ",m),T(!0);try{O("yaml")}catch(r){console.error("error writting firmware: ",r)}},Z=async()=>{let r=await fetch(t3(z,B)),m=await r.json();console.log("\uD83E\uDD16 ~ sendMessage ~ data:",m)},$=async()=>{Z()},K=r=>{console.log(r),D(m=>m=r)},Y=async()=>{let r=await tK();r||O("write")},X=async r=>{let m=await nG(t5(z),"POST",{yaml:r}),h=await m.json();console.log("Save Yaml, compileSessionId: ",h.compileSessionId),W(h.compileSessionId)};(0,H.useEffect)(()=>{let r=async()=>{if("yaml"==R)await X(G.current),setTimeout(()=>{O("compile")},1e3);else if("compile"==R)console.log("stage - compile"),await $();else if("write"==R)try{await tY(K,z,B),O("idle")}catch(r){K({message:"Error writing the device. Check that the USB connection and serial port are correctly configured.",details:{error:!0}})}else if("upload"==R){let r=navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("Opera");r?(D({message:"Connect your device and click select to chose the port. ",details:{error:!1}}),console.log("chormium based true")):(console.log("chormium based very false"),D({message:"You need Chrome, Opera or Edge to upload the code to the device.",details:{error:!0}}))}};r()},[R]);let[J,Q]=(0,H.useState)(null!==(m=null==S?void 0:S.deviceDefinitions)&&void 0!==m?m:(0,C.E)("pending"));(0,q.a)(r=>{L.bl.get({url:nU},r)},Q,null==S?void 0:S.deviceDefinitions);let tt=[{text:"Upload definition",icon:nR.W,action:r=>{V(r)},isVisible:r=>!0},{text:"Edit config file",icon:nD.z,action:r=>{E("editFile",r.getConfigFile())},isVisible:r=>r.isInitialized()&&r.getConfigFile()},{text:"Upload config file",icon:nR.W,action:async r=>{try{var m=await L.bl.get("/adminapi/v1/devices/"+r.data.name+"/yaml");V(r,m.data.yaml)}catch(r){console.error(r)}},isVisible:r=>r.isInitialized()&&r.getConfigFile()}];return(0,w.jsxs)(M.D,{title:"Devices",pageSession:f,children:[(0,w.jsxs)(t4.wR,{brokerUrl:t0(),children:[(0,w.jsx)(t9,{stage:R,onCancel:()=>T(!1),onSelect:Y,modalFeedback:P,showModal:A}),(0,w.jsx)(nO,{onSetStage:r=>O(r),onSetModalFeedback:r=>D(r),compileSessionId:B,stage:R})]}),(0,w.jsx)(F.V,{defaultView:"grid",integratedChat:!0,itemData:_,rowIcon:tD.F,sourceUrl:nz,initialItems:u,name:"device",columns:N.Z.columns(N.Z.column("name",r=>r.name,"name"),N.Z.column("device definition",r=>r.deviceDefinition,"deviceDefinition"),N.Z.column("config",r=>r.config,!1,r=>(0,w.jsx)(tq,{onPress:m=>{V(tR.O7.load(r))},children:"Upload"}))),extraFieldsForms:{deviceDefinition:I.z.union(J.isLoaded?J.data.items.map(r=>I.z.literal(ts.load(r).getId())):[]).after("name")},model:tR.O7,pageState:h,icons:nj,dataTableGridProps:{disableItemSelection:!0,onSelectItem:r=>{},getBody:r=>{var m;return(0,w.jsxs)(tj,{title:r.name,children:[(0,w.jsx)("div",{className:nL,children:(0,w.jsx)(tG.o,{type:"item",sourceUrl:nz,onDelete:async(r,m)=>{await L.bl.get("".concat(r,"/").concat(m,"/delete"))},deleteable:()=>!0,element:tR.O7.load(r),extraMenuActions:tt})}),(0,w.jsx)("div",{className:nq,children:(null==r?void 0:r.subsystem)?null==r?void 0:null===(m=r.subsystem)||void 0===m?void 0:m.map(m=>(0,w.jsx)(nI,{subsystem:m,deviceName:r.name})):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("p",{className:nk,children:"You need to upload the device"}),(0,w.jsx)(tq,{mt:"20px",ml:"20px",width:100,onPress:()=>{V(tR.O7.load(r))},children:"Upload"})]})})]})}},extraMenuActions:tt})]})}};h(5010);var nH=h(32878);let nW={name:A.V,sdk:E.S},nV="/adminapi/v1/devicesdks";var nZ={"devices/**":nB,"deviceSdks/**":{component:r=>{let{pageState:m,initialItems:h,itemData:u,pageSession:_}=r;return(0,w.jsx)(M.D,{title:"Device Sdks",pageSession:_,children:(0,w.jsx)(F.V,{integratedChat:!0,entityName:"devicesdks",itemData:u,rowIcon:nH.E,sourceUrl:nV,initialItems:h,numColumnsForm:1,name:"Sdk",onAdd:r=>r,onEdit:r=>r,columns:N.Z.columns(N.Z.column("id",r=>r.id,"id"),N.Z.column("name",r=>r.name,"name")),model:B,pageState:m,icons:nW,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,G.eq)(nV,["admin"])},"deviceCores/**":$,"deviceBoards/**":te,"deviceDefinitions/**":tP}},1940:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Hj:function(){return getPeripheralTopic},O7:function(){return DevicesModel},zm:function(){return DeviceSubsystemMonitor}});var _base__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(75370),_base__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(30195),_base__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(54283),_base__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(48115),path__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15153),path__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);let DevicesSchema=_base__WEBPACK_IMPORTED_MODULE_1__.V_.object({name:_base__WEBPACK_IMPORTED_MODULE_2__.z.string().hint("Device name").static().regex(/^[a-z0-9_]+$/,"Only lower case chars, numbers or _").id().search(),deviceDefinition:_base__WEBPACK_IMPORTED_MODULE_2__.z.string().hidden(),substitutions:_base__WEBPACK_IMPORTED_MODULE_2__.z.record(_base__WEBPACK_IMPORTED_MODULE_2__.z.string().optional(),_base__WEBPACK_IMPORTED_MODULE_2__.z.any().optional()).optional().hidden(),subsystem:_base__WEBPACK_IMPORTED_MODULE_2__.z.record(_base__WEBPACK_IMPORTED_MODULE_2__.z.string(),_base__WEBPACK_IMPORTED_MODULE_2__.z.any()).optional().hidden(),data:_base__WEBPACK_IMPORTED_MODULE_2__.z.array(_base__WEBPACK_IMPORTED_MODULE_2__.z.record(_base__WEBPACK_IMPORTED_MODULE_2__.z.string(),_base__WEBPACK_IMPORTED_MODULE_2__.z.any())).optional().hidden(),currentSdk:_base__WEBPACK_IMPORTED_MODULE_2__.z.string().hidden().generate("esphome"),location:_base__WEBPACK_IMPORTED_MODULE_2__.z.object({lat:_base__WEBPACK_IMPORTED_MODULE_2__.z.string(),long:_base__WEBPACK_IMPORTED_MODULE_2__.z.string()}).optional().location("lat","long").hidden().generate(()=>({lat:"41.3947846",long:"2.1939663"}),!0)});class DeviceSubsystemAction{getEndpoint(){return getPeripheralTopic(this.device,this.data.endpoint)}getValue(){return this.data.payload.value}constructor(r,m,h){this.data=h,this.device=r,this.subsystem=m}}class DeviceSubsystemMonitor{getEndpoint(){return getPeripheralTopic(this.device,this.data.endpoint)}getEventPath(){return this.getEndpoint().split("/").slice(2).join("/")}getLabel(){var r;return null!==(r=this.data.label)&&void 0!==r?r:this.data.name}getUnits(){return this.data.units?this.data.units:""}getValueAPIURL(){return"/adminapi/v1/devices/"+this.device+"/subsystems/"+this.subsystem+"/monitors/"+this.data.name}constructor(r,m,h){this.data=h,this.device=r,this.subsystem=m}}class DeviceSubsystem{getAction(r){if(!this.data||!this.data.actions)return;let m=this.data.actions.find(m=>m.name==r);if(m)return new DeviceSubsystemAction(this.device,r,m)}getMonitor(r){if(!this.data||!this.data.monitors)return;let m=this.data.monitors.find(m=>m.name==r);if(m)return new DeviceSubsystemMonitor(this.device,r,m)}constructor(r,m){this.data=m,this.device=r}}class DevicesModel extends _base__WEBPACK_IMPORTED_MODULE_3__.J{static getApiOptions(){return{name:"devices",prefix:"/api/v1/"}}isInitialized(){var r;return null!==(r=this.data)&&void 0!==r&&!!r.subsystem}getConfigDir(){var r;return"data/devices/"+(null===(r=this.data)||void 0===r?void 0:r.name)}getConfigFile(){var r;if((null===(r=this.data)||void 0===r?void 0:r.currentSdk)=="esphome")return path__WEBPACK_IMPORTED_MODULE_0___default().join(this.getConfigDir(),"config.yaml")}getSubsystem(r){if(!this.data||!this.data.subsystem)return;let m=this.data.subsystem.find(m=>m.name==r);if(m)return new DeviceSubsystem(this.data.name,m)}async getYaml(){let yaml;try{let response=await _base__WEBPACK_IMPORTED_MODULE_4__.bl.get("/adminapi/v1/deviceDefinitions/"+this.data.deviceDefinition);if(response.isError){console.log(response.error);return}let deviceDefinition=response.data,response1=await _base__WEBPACK_IMPORTED_MODULE_4__.bl.get("/adminapi/v1/deviceBoards/"+deviceDefinition.board);if(response1.isError){console.log(response1.error);return}console.log("---------deviceDefinition----------",deviceDefinition),deviceDefinition.board=response1.data;let jsCode=deviceDefinition.config.components,deviceCode="device("+jsCode.replace(/;/g,"")+")";console.log("-------DEVICE CODE------------",deviceCode);let deviceObj=eval(deviceCode),componentsTree=deviceObj.getComponentsTree(this.data.name,deviceDefinition);yaml=deviceObj.dump("yaml").replace(/'@/g,"").replace(/@'/g,"");let subsystems=deviceObj.getSubsystemsTree(this.data.name,deviceDefinition),deviceObject=await _base__WEBPACK_IMPORTED_MODULE_4__.bl.get("/adminapi/v1/devices/"+this.data.name);if(await _base__WEBPACK_IMPORTED_MODULE_4__.bl.post("/adminapi/v1/devices/"+this.data.name+"/yamls",{yaml}),deviceObject.isError){console.error(deviceObject.error);return}deviceObject.data.subsystem=subsystems,_base__WEBPACK_IMPORTED_MODULE_4__.bl.post("/adminapi/v1/devices/"+this.data.name,deviceObject.data),console.log("ComponentsTree: ",componentsTree),console.log("Subsystems: ",subsystems)}catch(error){console.log("Cant get device, error: ",error)}return yaml}create(r){let m=super.create(r);return m}read(r){let m=super.read(r);return m}update(r,m){let h=super.update(r,m);return h}list(r,m,h,u){let _=super.list(r,m,h,u);return _}delete(r){let m=super.delete(r);return m}static _newInstance(r,m){return new DevicesModel(r,m)}static load(r,m){return this._newInstance(r,m)}constructor(r,m){super(r,DevicesSchema,m,"Test")}}let getPeripheralTopic=function(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"devices/"+r+m}},79562:function(r,m,h){"use strict";h.d(m,{A:function(){return R}});var u=h(52322),_=h(2784),f=h(8939),g=h(60545),w=h(70396);let S="  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-9px _miw-9px _fs-0 _pe-none _w-9px _h-9px ",E=" _fow-400",A=" _fow-900",T=" _ml-1481558400",I=" _ml-1481558214",P=" _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px   _o-0d0t9746  _col-675002279 _ff-299667014 _fow-233016047 _ls-167743966 _fos-229441127 _lh-222976480 font_body  ",D="  is_SizableText",R=r=>{let{loading:m,icon:h,text:R,bold:C,color:q,...L}=r;return(0,u.jsxs)(f.sL,{ai:"center",jc:"center",bc:null!=q?q:"$color5",p:2,px:"$3",br:25,...L,children:[h&&_.cloneElement(h,{size:20,strokeWidth:.7,color:"var(--color)"}),R&&(0,u.jsx)("span",{className:(0,w.concatClassName)(D+(P+(h?I:T)+" ")+(C?A:E)),children:R}),m&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:S}),(0,u.jsx)(g.$,{color:"var(--color8)",scale:.7,size:"small"})]})]})};h(71619)},1888:function(r,m,h){"use strict";h.d(m,{F7:function(){return g},eq:function(){return w}});var u=h(46149),_=h(6429),f=h(48115);let g=r=>u.l.SSR?r:void 0;function w(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return g(async g=>{var w,S,E,A,T,I;let P={itemsPerPage:parseInt(g.query.itemsPerPage)?parseInt(g.query.itemsPerPage):"",page:parseInt(g.query.page,10)?parseInt(g.query.page,10):"",search:null!==(w=g.query.search)&&void 0!==w?w:"",orderBy:null!==(S=g.query.orderBy)&&void 0!==S?S:"",orderDirection:null!==(E=g.query.orderDirection)&&void 0!==E?E:"",view:null!==(A=g.query.view)&&void 0!==A?A:"",item:null!==(T=g.query.item)&&void 0!==T?T:"",editFile:null!==(I=g.query.editFile)&&void 0!==I?I:"",..."function"==typeof h?await h(g):h},D="function"==typeof r?r(g):r;return(0,_.NA)(g,m,{sourceUrl:D,initialItems:await f.bl.get({url:(0,_.VM)(D,g),...P}),itemData:g.query.item?await f.bl.get((0,_.VM)(D+"/"+g.query.item,g)):"",extraData:{..."function"==typeof u?await u(g):u},pageState:{...P}})})}},30025:function(){},5010:function(){},76649:function(){},71619:function(){}}]);